cf6b8a70040e590aa2a34a8fa43de267
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.createTreeNode = createTreeNode;
exports.getTreeNodeById = getTreeNodeById;
exports.getAllTreeNodes = getAllTreeNodes;
exports.getTreeStructure = getTreeStructure;
exports.updateTreeNode = updateTreeNode;
exports.deleteTreeNode = deleteTreeNode;
exports.searchTreeNodes = searchTreeNodes;
exports.moveTreeNode = moveTreeNode;
exports.reorderTreeNode = reorderTreeNode;
exports.checkCircularReference = checkCircularReference;
exports.recordTreeNodeMove = recordTreeNodeMove;
const pgClient_1 = require("../../../infrastructure/database/pgClient");
// =====================================================
// 기본 CRUD 함수
// =====================================================
async function createTreeNode(request) {
    const pgClient = (0, pgClient_1.getPgClient)();
    if (!pgClient) {
        throw new Error('PostgreSQL 클라이언트가 초기화되지 않았습니다.');
    }
    // 새 노드의 sort_order 계산
    let sortOrder = 0;
    if (request.parentId !== null && request.parentId !== undefined) {
        const siblings = await pgClient.query('SELECT sort_order FROM tree_nodes WHERE parent_id = $1 ORDER BY sort_order DESC LIMIT 1', [request.parentId]);
        if (siblings.rows.length > 0) {
            sortOrder = siblings.rows[0].sort_order + 1;
        }
    }
    const result = await pgClient.query('INSERT INTO tree_nodes (name, type, parent_id, sort_order, created_by) VALUES ($1, $2, $3, $4, $5) RETURNING *', [request.name, request.type, request.parentId, sortOrder, request.createdBy]);
    const row = result.rows[0];
    return {
        id: row.id,
        name: row.name,
        type: row.type,
        parentId: row.parent_id,
        sortOrder: row.sort_order,
        createdAt: row.created_at,
        updatedAt: row.updated_at,
        createdBy: row.created_by
    };
}
async function getTreeNodeById(id) {
    const pgClient = (0, pgClient_1.getPgClient)();
    if (!pgClient) {
        throw new Error('PostgreSQL 클라이언트가 초기화되지 않았습니다.');
    }
    const result = await pgClient.query('SELECT * FROM tree_nodes WHERE id = $1', [id]);
    if (result.rows.length === 0) {
        return null;
    }
    const row = result.rows[0];
    return {
        id: row.id,
        name: row.name,
        type: row.type,
        parentId: row.parent_id,
        sortOrder: row.sort_order,
        createdAt: row.created_at,
        updatedAt: row.updated_at,
        createdBy: row.created_by
    };
}
async function getAllTreeNodes() {
    const pgClient = (0, pgClient_1.getPgClient)();
    if (!pgClient) {
        throw new Error('PostgreSQL 클라이언트가 초기화되지 않았습니다.');
    }
    const result = await pgClient.query('SELECT * FROM tree_nodes ORDER BY sort_order, name');
    const nodes = result.rows.map((row) => ({
        id: row.id,
        name: row.name,
        type: row.type,
        parentId: row.parent_id,
        sortOrder: row.sort_order,
        createdAt: row.created_at,
        updatedAt: row.updated_at,
        createdBy: row.created_by
    }));
    // 폴더 타입인 경우에만 테스트케이스 개수 계산
    for (const node of nodes) {
        if (node.type === 'folder') {
            // 해당 폴더의 직접적인 테스트케이스만 계산
            const testCaseCountResult = await pgClient.query(`
        SELECT 
          (SELECT COUNT(*) FROM tree_nodes WHERE type = 'testcase' AND parent_id = $1) +
          (SELECT COUNT(*) FROM testcases WHERE folder_id = $1) as count
      `, [node.id]);
            node.testCaseCount = parseInt(testCaseCountResult.rows[0]?.count || '0');
        }
    }
    return nodes;
}
async function getTreeStructure() {
    const pgClient = (0, pgClient_1.getPgClient)();
    if (!pgClient) {
        throw new Error('PostgreSQL 클라이언트가 초기화되지 않았습니다.');
    }
    // 모든 노드 조회
    const allNodes = await getAllTreeNodes();
    // 테스트케이스 수 계산
    const testCaseCounts = await pgClient.query(`
    SELECT parent_id, COUNT(*) as count 
    FROM tree_nodes 
    WHERE type = 'testcase' 
    GROUP BY parent_id
  `);
    const countMap = new Map();
    testCaseCounts.rows.forEach((row) => {
        countMap.set(row.parent_id, parseInt(row.count));
    });
    // 트리 구조 생성
    const nodeMap = new Map();
    const rootNodes = [];
    // 먼저 모든 노드를 맵에 추가
    allNodes.forEach(node => {
        const treeNode = {
            ...node,
            children: [],
            testCaseCount: countMap.get(node.id) || 0
        };
        nodeMap.set(node.id, treeNode);
    });
    // 부모-자식 관계 구성
    allNodes.forEach(node => {
        const treeNode = nodeMap.get(node.id);
        if (node.parentId && node.parentId !== null) {
            const parent = nodeMap.get(node.parentId);
            if (parent) {
                parent.children.push(treeNode);
            }
            else {
                rootNodes.push(treeNode);
            }
        }
        else {
            rootNodes.push(treeNode);
        }
    });
    return rootNodes;
}
async function updateTreeNode(id, updates) {
    const pgClient = (0, pgClient_1.getPgClient)();
    if (!pgClient) {
        throw new Error('PostgreSQL 클라이언트가 초기화되지 않았습니다.');
    }
    const setClauses = [];
    const values = [];
    let paramIndex = 1;
    if (updates.name !== undefined) {
        setClauses.push(`name = $${paramIndex++}`);
        values.push(updates.name);
    }
    if (updates.parentId !== undefined) {
        setClauses.push(`parent_id = $${paramIndex++}`);
        values.push(updates.parentId);
    }
    if (updates.sortOrder !== undefined) {
        setClauses.push(`sort_order = $${paramIndex++}`);
        values.push(updates.sortOrder);
    }
    if (setClauses.length === 0) {
        return getTreeNodeById(id);
    }
    values.push(id);
    const query = `UPDATE tree_nodes SET ${setClauses.join(', ')} WHERE id = $${paramIndex} RETURNING *`;
    const result = await pgClient.query(query, values);
    if (result.rows.length === 0) {
        return null;
    }
    const row = result.rows[0];
    return {
        id: row.id,
        name: row.name,
        type: row.type,
        parentId: row.parent_id,
        sortOrder: row.sort_order,
        createdAt: row.created_at,
        updatedAt: row.updated_at,
        createdBy: row.created_by
    };
}
async function deleteTreeNode(id) {
    const pgClient = (0, pgClient_1.getPgClient)();
    if (!pgClient) {
        throw new Error('PostgreSQL 클라이언트가 초기화되지 않았습니다.');
    }
    const result = await pgClient.query('DELETE FROM tree_nodes WHERE id = $1 RETURNING id', [id]);
    return result.rows.length > 0;
}
// =====================================================
// 검색 함수
// =====================================================
async function searchTreeNodes(request) {
    const pgClient = (0, pgClient_1.getPgClient)();
    if (!pgClient) {
        throw new Error('PostgreSQL 클라이언트가 초기화되지 않았습니다.');
    }
    let query = 'SELECT * FROM tree_nodes WHERE 1=1';
    const values = [];
    let paramIndex = 1;
    if (request.query) {
        query += ` AND name ILIKE $${paramIndex++}`;
        values.push(`%${request.query}%`);
    }
    if (request.type) {
        query += ` AND type = $${paramIndex++}`;
        values.push(request.type);
    }
    if (request.parentId !== undefined) {
        query += ` AND parent_id = $${paramIndex++}`;
        values.push(request.parentId);
    }
    query += ' ORDER BY sort_order, name';
    if (request.limit) {
        query += ` LIMIT $${paramIndex++}`;
        values.push(request.limit);
    }
    if (request.offset) {
        query += ` OFFSET $${paramIndex++}`;
        values.push(request.offset);
    }
    const result = await pgClient.query(query, values);
    const nodes = result.rows.map((row) => ({
        id: row.id,
        name: row.name,
        type: row.type,
        parentId: row.parent_id,
        sortOrder: row.sort_order,
        createdAt: row.created_at,
        updatedAt: row.updated_at,
        createdBy: row.created_by
    }));
    // 전체 개수 조회
    let countQuery = 'SELECT COUNT(*) FROM tree_nodes WHERE 1=1';
    const countValues = [];
    let countParamIndex = 1;
    if (request.query) {
        countQuery += ` AND name ILIKE $${countParamIndex++}`;
        countValues.push(`%${request.query}%`);
    }
    if (request.type) {
        countQuery += ` AND type = $${countParamIndex++}`;
        countValues.push(request.type);
    }
    if (request.parentId !== undefined) {
        countQuery += ` AND parent_id = $${countParamIndex++}`;
        countValues.push(request.parentId);
    }
    const countResult = await pgClient.query(countQuery, countValues);
    const total = parseInt(countResult.rows[0].count);
    const hasMore = (request.offset || 0) + nodes.length < total;
    return { nodes, total, hasMore };
}
// =====================================================
// 드래그 앤 드롭 관련 함수
// =====================================================
async function moveTreeNode(nodeId, newParentId) {
    const pgClient = (0, pgClient_1.getPgClient)();
    if (!pgClient) {
        throw new Error('PostgreSQL 클라이언트가 초기화되지 않았습니다.');
    }
    try {
        await pgClient.query('BEGIN');
        // 새 부모의 최대 순서 조회
        let newSortOrder = 0;
        if (newParentId !== null) {
            const maxSortResult = await pgClient.query('SELECT COALESCE(MAX(sort_order), 0) as max_sort FROM tree_nodes WHERE parent_id = $1', [newParentId]);
            newSortOrder = maxSortResult.rows[0].max_sort + 1;
        }
        // 노드 이동
        const result = await pgClient.query('UPDATE tree_nodes SET parent_id = $1, sort_order = $2 WHERE id = $3 RETURNING *', [newParentId, newSortOrder, nodeId]);
        await pgClient.query('COMMIT');
        if (result.rows.length === 0) {
            return null;
        }
        const row = result.rows[0];
        return {
            id: row.id,
            name: row.name,
            type: row.type,
            parentId: row.parent_id,
            sortOrder: row.sort_order,
            createdAt: row.created_at,
            updatedAt: row.updated_at,
            createdBy: row.created_by
        };
    }
    catch (error) {
        await pgClient.query('ROLLBACK');
        throw error;
    }
}
async function reorderTreeNode(nodeId, targetNodeId, position) {
    const pgClient = (0, pgClient_1.getPgClient)();
    if (!pgClient) {
        throw new Error('PostgreSQL 클라이언트가 초기화되지 않았습니다.');
    }
    try {
        await pgClient.query('BEGIN');
        // 현재 노드와 대상 노드 정보 조회
        const draggedNode = await getTreeNodeById(nodeId);
        const targetNode = await getTreeNodeById(targetNodeId);
        if (!draggedNode || !targetNode) {
            throw new Error('노드를 찾을 수 없습니다.');
        }
        // 같은 부모 노드 내에서만 순서 변경 가능
        if (draggedNode.parentId !== targetNode.parentId) {
            throw new Error('같은 부모 노드 내에서만 순서 변경이 가능합니다.');
        }
        // 대상 노드의 현재 순서 조회
        const targetSortOrder = targetNode.sortOrder || 0;
        // 새로운 순서 계산
        let newSortOrder;
        if (position === 'before') {
            newSortOrder = targetSortOrder;
            // 대상 노드와 그 이후 노드들의 순서를 1씩 증가
            await pgClient.query('UPDATE tree_nodes SET sort_order = sort_order + 1 WHERE parent_id = $1 AND sort_order >= $2', [targetNode.parentId, targetSortOrder]);
        }
        else {
            newSortOrder = targetSortOrder + 1;
            // 대상 노드 이후 노드들의 순서를 1씩 증가
            await pgClient.query('UPDATE tree_nodes SET sort_order = sort_order + 1 WHERE parent_id = $1 AND sort_order > $2', [targetNode.parentId, targetSortOrder]);
        }
        // 드래그한 노드의 순서 업데이트
        const result = await pgClient.query('UPDATE tree_nodes SET sort_order = $1 WHERE id = $2 RETURNING *', [newSortOrder, nodeId]);
        await pgClient.query('COMMIT');
        if (result.rows.length === 0) {
            return null;
        }
        const row = result.rows[0];
        return {
            id: row.id,
            name: row.name,
            type: row.type,
            parentId: row.parent_id,
            sortOrder: row.sort_order,
            createdAt: row.created_at,
            updatedAt: row.updated_at,
            createdBy: row.created_by
        };
    }
    catch (error) {
        await pgClient.query('ROLLBACK');
        throw error;
    }
}
// =====================================================
// 유효성 검사 함수
// =====================================================
async function checkCircularReference(nodeId, newParentId) {
    const pgClient = (0, pgClient_1.getPgClient)();
    if (!pgClient) {
        throw new Error('PostgreSQL 클라이언트가 초기화되지 않았습니다.');
    }
    // 자기 자신을 부모로 설정하는 경우
    if (nodeId === newParentId) {
        return true;
    }
    // 반복문으로 순환 참조 검사 (재귀 대신)
    const visited = new Set();
    let currentId = newParentId;
    while (currentId !== null) {
        // 이미 방문한 ID가 있다면 순환 참조
        if (visited.has(currentId)) {
            return true;
        }
        visited.add(currentId);
        // 현재 ID가 이동하려는 노드와 같다면 순환 참조
        if (currentId === nodeId) {
            return true;
        }
        // 부모 ID 조회
        const result = await pgClient.query('SELECT parent_id FROM tree_nodes WHERE id = $1', [currentId]);
        const parentId = result.rows[0]?.parent_id;
        if (!parentId) {
            break; // 루트에 도달
        }
        currentId = parentId;
    }
    return false;
}
// =====================================================
// 히스토리 관련 함수
// =====================================================
async function recordTreeNodeMove(history) {
    const pgClient = (0, pgClient_1.getPgClient)();
    if (!pgClient) {
        throw new Error('PostgreSQL 클라이언트가 초기화되지 않았습니다.');
    }
    await pgClient.query('INSERT INTO tree_node_move_history (node_id, old_parent_id, new_parent_id, old_sort_order, new_sort_order, moved_by) VALUES ($1, $2, $3, $4, $5, $6)', [history.nodeId, history.oldParentId, history.newParentId, history.oldSortOrder, history.newSortOrder, history.movedBy]);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzLzNpLWExLTIwMjEtMDE3L0RvY3VtZW50cy9xdWVzdC9EZXNrdG9wL3F1ZXN0L3NyYy9tYWluL2FwcC9kb21haW5zL3RyZWUvcmVwb3NpdG9yaWVzL3RyZWVSZXBvc2l0b3J5LnRzIiwibWFwcGluZ3MiOiI7O0FBT0Esd0NBa0NDO0FBRUQsMENBdUJDO0FBRUQsMENBa0NDO0FBRUQsNENBcURDO0FBRUQsd0NBaURDO0FBRUQsd0NBUUM7QUFNRCwwQ0EyRUM7QUFNRCxvQ0E4Q0M7QUFFRCwwQ0FzRUM7QUFNRCx3REF3Q0M7QUFNRCxnREFpQkM7QUE1ZUQsd0VBQXdFO0FBR3hFLHdEQUF3RDtBQUN4RCxhQUFhO0FBQ2Isd0RBQXdEO0FBRWpELEtBQUssVUFBVSxjQUFjLENBQUMsT0FBOEI7SUFDakUsTUFBTSxRQUFRLEdBQUcsSUFBQSxzQkFBVyxHQUFFLENBQUM7SUFDL0IsSUFBSSxDQUFDLFFBQVEsRUFBRSxDQUFDO1FBQ2QsTUFBTSxJQUFJLEtBQUssQ0FBQyxnQ0FBZ0MsQ0FBQyxDQUFDO0lBQ3BELENBQUM7SUFFRCxzQkFBc0I7SUFDdEIsSUFBSSxTQUFTLEdBQUcsQ0FBQyxDQUFDO0lBQ2xCLElBQUksT0FBTyxDQUFDLFFBQVEsS0FBSyxJQUFJLElBQUksT0FBTyxDQUFDLFFBQVEsS0FBSyxTQUFTLEVBQUUsQ0FBQztRQUNoRSxNQUFNLFFBQVEsR0FBRyxNQUFNLFFBQVEsQ0FBQyxLQUFLLENBQ25DLHlGQUF5RixFQUN6RixDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsQ0FDbkIsQ0FBQztRQUNGLElBQUksUUFBUSxDQUFDLElBQUksQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFLENBQUM7WUFDN0IsU0FBUyxHQUFHLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsVUFBVSxHQUFHLENBQUMsQ0FBQztRQUM5QyxDQUFDO0lBQ0gsQ0FBQztJQUVELE1BQU0sTUFBTSxHQUFHLE1BQU0sUUFBUSxDQUFDLEtBQUssQ0FDakMsZ0hBQWdILEVBQ2hILENBQUMsT0FB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R0FBRyxDQUFDLFNBQVMsQ0FBQyxDQUFDO1FBRXZCLDZCQUE2QjtRQUM3QixJQUFJLFNBQVMsS0FBSyxNQUFNLEVBQUUsQ0FBQztZQUN6QixPQUFPLElBQUksQ0FBQztRQUNkLENBQUM7UUFFRCxXQUFXO1FBQ1gsTUFBTSxNQUFNLEdBQUcsTUFBTSxRQUFRLENBQUMsS0FBSyxDQUFDLGdEQUFnRCxFQUFFLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQztRQUNuRyxNQUFNLFFBQVEsR0FBRyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLFNBQVMsQ0FBQztRQUUzQyxJQUFJLENBQUMsUUFBUSxFQUFFLENBQUM7WUFDZCxNQUFNLENBQUMsU0FBUztRQUNsQixDQUFDO1FBRUQsU0FBUyxHQUFHLFFBQVEsQ0FBQztJQUN2QixDQUFDO0lBRUQsT0FBTyxLQUFLLENBQUM7QUFDZixDQUFDO0FBRUQsd0RBQXdEO0FBQ3hELGFBQWE7QUFDYix3REFBd0Q7QUFFakQsS0FBSyxVQUFVLGtCQUFrQixDQUFDLE9BT3hDO0lBQ0MsTUFBTSxRQUFRLEdBQUcsSUFBQSxzQkFBVyxHQUFFLENBQUM7SUFDL0IsSUFBSSxDQUFDLFFBQVEsRUFBRSxDQUFDO1FBQ2QsTUFBTSxJQUFJLEtBQUssQ0FBQyxnQ0FBZ0MsQ0FBQyxDQUFDO0lBQ3BELENBQUM7SUFFRCxNQUFNLFFBQVEsQ0FBQyxLQUFLLENBQ2xCLHNKQUFzSixFQUN0SixDQUFDLE9BQU8sQ0FBQyxNQUFNLEVBQUUsT0FBTyxDQUFDLFdBQVcsRUFBRSxPQUFPLENBQUMsV0FBVyxFQUFFLE9BQU8sQ0FBQyxZQUFZLEVBQUUsT0FBTyxDQUFDLFlBQVksRUFBRSxPQUFPLENBQUMsT0FBTyxDQUFDLENBQ3hILENBQUM7QUFDSixDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy8zaS1hMS0yMDIxLTAxNy9Eb2N1bWVudHMvcXVlc3QvRGVza3RvcC9xdWVzdC9zcmMvbWFpbi9hcHAvZG9tYWlucy90cmVlL3JlcG9zaXRvcmllcy90cmVlUmVwb3NpdG9yeS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBnZXRQZ0NsaWVudCB9IGZyb20gJy4uLy4uLy4uL2luZnJhc3RydWN0dXJlL2RhdGFiYXNlL3BnQ2xpZW50JztcbmltcG9ydCB7IFRyZWVOb2RlLCBDcmVhdGVUcmVlTm9kZVJlcXVlc3QsIFVwZGF0ZVRyZWVOb2RlUmVxdWVzdCwgVHJlZVNlYXJjaFJlcXVlc3QsIFRyZWVTZWFyY2hSZXN1bHQgfSBmcm9tICcuLi90eXBlcyc7XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyDquLDrs7ggQ1JVRCDtlajsiJhcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjcmVhdGVUcmVlTm9kZShyZXF1ZXN0OiBDcmVhdGVUcmVlTm9kZVJlcXVlc3QpOiBQcm9taXNlPFRyZWVOb2RlPiB7XG4gIGNvbnN0IHBnQ2xpZW50ID0gZ2V0UGdDbGllbnQoKTtcbiAgaWYgKCFwZ0NsaWVudCkge1xuICAgIHRocm93IG5ldyBFcnJvcignUG9zdGdyZVNRTCDtgbTrnbzsnbTslrjtirjqsIAg7LSI6riw7ZmU65CY7KeAIOyViuyVmOyKteuLiOuLpC4nKTtcbiAgfVxuXG4gIC8vIOyDiCDrhbjrk5zsnZggc29ydF9vcmRlciDqs4TsgrBcbiAgbGV0IHNvcnRPcmRlciA9IDA7XG4gIGlmIChyZXF1ZXN0LnBhcmVudElkICE9PSBudWxsICYmIHJlcXVlc3QucGFyZW50SWQgIT09IHVuZGVmaW5lZCkge1xuICAgIGNvbnN0IHNpYmxpbmdzID0gYXdhaXQgcGdDbGllbnQucXVlcnkoXG4gICAgICAnU0VMRUNUIHNvcnRfb3JkZXIgRlJPTSB0cmVlX25vZGVzIFdIRVJFIHBhcmVudF9pZCA9ICQxIE9SREVSIEJZIHNvcnRfb3JkZXIgREVTQyBMSU1JVCAxJyxcbiAgICAgIFtyZXF1ZXN0LnBhcmVudElkXVxuICAgICk7XG4gICAgaWYgKHNpYmxpbmdzLnJvd3MubGVuZ3RoID4gMCkge1xuICAgICAgc29ydE9yZGVyID0gc2libGluZ3Mucm93c1swXS5zb3J0X29yZGVyICsgMTtcbiAgICB9XG4gIH1cblxuICBjb25zdCByZXN1bHQgPSBhd2FpdCBwZ0NsaWVudC5xdWVyeShcbiAgICAnSU5TRVJUIElOVE8gdHJlZV9ub2RlcyAobmFtZSwgdHlwZSwgcGFyZW50X2lkLCBzb3J0X29yZGVyLCBjcmVhdGVkX2J5KSBWQUxVRVMgKCQxLCAkMiwgJDMsICQ0LCAkNSkgUkVUVVJOSU5HIConLFxuICAgIFtyZXF1ZXN0Lm5hbWUsIHJlcXVlc3QudHlwZSwgcmVxdWVzdC5wYXJlbnRJZCwgc29ydE9yZGVyLCByZXF1ZXN0LmNyZWF0ZWRCeV1cbiAgKTtcblxuICBjb25zdCByb3cgPSByZXN1bHQucm93c1swXTtcbiAgcmV0dXJuIHtcbiAgICBpZDogcm93LmlkLFxuICAgIG5hbWU6IHJvdy5uYW1lLFxuICAgIHR5cGU6IHJvdy50eXBlLFxuICAgIHBhcmVudElkOiByb3cucGFyZW50X2lkLFxuICAgIHNvcnRPcmRlcjogcm93LnNvcnRfb3JkZXIsXG4gICAgY3JlYXRlZEF0OiByb3cuY3JlYXRlZF9hdCxcbiAgICB1cGRhdGVkQXQ6IHJvdy51cGRhdGVkX2F0LFxuICAgIGNyZWF0ZWRCeTogcm93LmNyZWF0ZWRfYnlcbiAgfTtcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldFRyZWVOb2RlQnlJZChpZDogbnVtYmVyKTogUHJvbWlzZTxUcmVlTm9kZSB8IG51bGw+IHtcbiAgY29uc3QgcGdDbGllbnQgPSBnZXRQZ0NsaWVudCgpO1xuICBpZiAoIXBnQ2xpZW50KSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdQb3N0Z3JlU1FMIO2BtOudvOydtOyWuO2KuOqwgCDstIjquLDtmZTrkJjsp4Ag7JWK7JWY7Iq164uI64ukLicpO1xuICB9XG5cbiAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcGdDbGllbnQucXVlcnkoJ1NFTEVDVCAqIEZST00gdHJlZV9ub2RlcyBXSEVSRSBpZCA9ICQxJywgW2lkXSk7XG4gIFxuICBpZiAocmVzdWx0LnJvd3MubGVuZ3RoID09PSAwKSB7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICBjb25zdCByb3cgPSByZXN1bHQucm93c1swXTtcbiAgcmV0dXJuIHtcbiAgICBpZDogcm93LmlkLFxuICAgIG5hbWU6IHJvdy5uYW1lLFxuICAgIHR5cGU6IHJvdy50eXBlLFxuICAgIHBhcmVudElkOiByb3cucGFyZW50X2lkLFxuICAgIHNvcnRPcmRlcjogcm93LnNvcnRfb3JkZXIsXG4gICAgY3JlYXRlZEF0OiByb3cuY3JlYXRlZF9hdCxcbiAgICB1cGRhdGVkQXQ6IHJvdy51cGRhdGVkX2F0LFxuICAgIGNyZWF0ZWRCeTogcm93LmNyZWF0ZWRfYnlcbiAgfTtcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldEFsbFRyZWVOb2RlcygpOiBQcm9taXNlPFRyZWVOb2RlW10+IHtcbiAgY29uc3QgcGdDbGllbnQgPSBnZXRQZ0NsaWVudCgpO1xuICBpZiAoIXBnQ2xpZW50KSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdQb3N0Z3JlU1FMIO2BtOudvOydtOyWuO2KuOqwgCDstIjquLDtmZTrkJjsp4Ag7JWK7JWY7Iq164uI64ukLicpO1xuICB9XG5cbiAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcGdDbGllbnQucXVlcnkoJ1NFTEVDVCAqIEZST00gdHJlZV9ub2RlcyBPUkRFUiBCWSBzb3J0X29yZGVyLCBuYW1lJyk7XG4gIFxuICBjb25zdCBub2RlcyA9IHJlc3VsdC5yb3dzLm1hcCgocm93OiBhbnkpID0+ICh7XG4gICAgaWQ6IHJvdy5pZCxcbiAgICBuYW1lOiByb3cubmFtZSxcbiAgICB0eXBlOiByb3cudHlwZSxcbiAgICBwYXJlbnRJZDogcm93LnBhcmVudF9pZCxcbiAgICBzb3J0T3JkZXI6IHJvdy5zb3J0X29yZGVyLFxuICAgIGNyZWF0ZWRBdDogcm93LmNyZWF0ZWRfYXQsXG4gICAgdXBkYXRlZEF0OiByb3cudXBkYXRlZF9hdCxcbiAgICBjcmVhdGVkQnk6IHJvdy5jcmVhdGVkX2J5XG4gIH0pKTtcblxuICAvLyDtj7TrjZQg7YOA7J6F7J24IOqyveyasOyXkOunjCDthYzsiqTtirjsvIDsnbTsiqQg6rCc7IiYIOqzhOyCsFxuICBmb3IgKGNvbnN0IG5vZGUgb2Ygbm9kZXMpIHtcbiAgICBpZiAobm9kZS50eXBlID09PSAnZm9sZGVyJykge1xuICAgICAgLy8g7ZW064u5IO2PtOuNlOydmCDsp4HsoJHsoIHsnbgg7YWM7Iqk7Yq47LyA7J207Iqk66eMIOqzhOyCsFxuICAgICAgY29uc3QgdGVzdENhc2VDb3VudFJlc3VsdCA9IGF3YWl0IHBnQ2xpZW50LnF1ZXJ5KGBcbiAgICAgICAgU0VMRUNUIFxuICAgICAgICAgIChTRUxFQ1QgQ09VTlQoKikgRlJPTSB0cmVlX25vZGVzIFdIRVJFIHR5cGUgPSAndGVzdGNhc2UnIEFORCBwYXJlbnRfaWQgPSAkMSkgK1xuICAgICAgICAgIChTRUxFQ1QgQ09VTlQoKikgRlJPTSB0ZXN0Y2FzZXMgV0hFUkUgZm9sZGVyX2lkID0gJDEpIGFzIGNvdW50XG4gICAgICBgLCBbbm9kZS5pZF0pO1xuICAgICAgXG4gICAgICAobm9kZSBhcyBhbnkpLnRlc3RDYXNlQ291bnQgPSBwYXJzZUludCh0ZXN0Q2FzZUNvdW50UmVzdWx0LnJvd3NbMF0/LmNvdW50IHx8ICcwJyk7XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIG5vZGVzO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0VHJlZVN0cnVjdHVyZSgpOiBQcm9taXNlPFRyZWVOb2RlW10+IHtcbiAgY29uc3QgcGdDbGllbnQgPSBnZXRQZ0NsaWVudCgpO1xuICBpZiAoIXBnQ2xpZW50KSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdQb3N0Z3JlU1FMIO2BtOudvOydtOyWuO2KuOqwgCDstIjquLDtmZTrkJjsp4Ag7JWK7JWY7Iq164uI64ukLicpO1xuICB9XG5cbiAgLy8g66qo65OgIOuFuOuTnCDsobDtmoxcbiAgY29uc3QgYWxsTm9kZXMgPSBhd2FpdCBnZXRBbGxUcmVlTm9kZXMoKTtcbiAgXG4gIC8vIO2FjOyKpO2KuOy8gOydtOyKpCDsiJgg6rOE7IKwXG4gIGNvbnN0IHRlc3RDYXNlQ291bnRzID0gYXdhaXQgcGdDbGllbnQucXVlcnkoYFxuICAgIFNFTEVDVCBwYXJlbnRfaWQsIENPVU5UKCopIGFzIGNvdW50IFxuICAgIEZST00gdHJlZV9ub2RlcyBcbiAgICBXSEVSRSB0eXBlID0gJ3Rlc3RjYXNlJyBcbiAgICBHUk9VUCBCWSBwYXJlbnRfaWRcbiAgYCk7XG4gIFxuICBjb25zdCBjb3VudE1hcCA9IG5ldyBNYXA8bnVtYmVyLCBudW1iZXI+KCk7XG4gIHRlc3RDYXNlQ291bnRzLnJvd3MuZm9yRWFjaCgocm93OiBhbnkpID0+IHtcbiAgICBjb3VudE1hcC5zZXQocm93LnBhcmVudF9pZCwgcGFyc2VJbnQocm93LmNvdW50KSk7XG4gIH0pO1xuXG4gIC8vIO2KuOumrCDqtazsobAg7IOd7ISxXG4gIGNvbnN0IG5vZGVNYXAgPSBuZXcgTWFwPG51bWJlciwgVHJlZU5vZGU+KCk7XG4gIGNvbnN0IHJvb3ROb2RlczogVHJlZU5vZGVbXSA9IFtdO1xuXG4gIC8vIOuovOyggCDrqqjrk6Ag64W465Oc66W8IOunteyXkCDstpTqsIBcbiAgYWxsTm9kZXMuZm9yRWFjaChub2RlID0+IHtcbiAgICBjb25zdCB0cmVlTm9kZTogVHJlZU5vZGUgPSB7XG4gICAgICAuLi5ub2RlLFxuICAgICAgY2hpbGRyZW46IFtdLFxuICAgICAgdGVzdENhc2VDb3VudDogY291bnRNYXAuZ2V0KG5vZGUuaWQpIHx8IDBcbiAgICB9O1xuICAgIG5vZGVNYXAuc2V0KG5vZGUuaWQsIHRyZWVOb2RlKTtcbiAgfSk7XG5cbiAgLy8g67aA66qoLeyekOyLnSDqtIDqs4Qg6rWs7ISxXG4gIGFsbE5vZGVzLmZvckVhY2gobm9kZSA9PiB7XG4gICAgY29uc3QgdHJlZU5vZGUgPSBub2RlTWFwLmdldChub2RlLmlkKSE7XG4gICAgXG4gICAgaWYgKG5vZGUucGFyZW50SWQgJiYgbm9kZS5wYXJlbnRJZCAhPT0gbnVsbCkge1xuICAgICAgY29uc3QgcGFyZW50ID0gbm9kZU1hcC5nZXQobm9kZS5wYXJlbnRJZCk7XG4gICAgICBpZiAocGFyZW50KSB7XG4gICAgICAgIHBhcmVudC5jaGlsZHJlbiEucHVzaCh0cmVlTm9kZSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByb290Tm9kZXMucHVzaCh0cmVlTm9kZSk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHJvb3ROb2Rlcy5wdXNoKHRyZWVOb2RlKTtcbiAgICB9XG4gIH0pO1xuXG4gIHJldHVybiByb290Tm9kZXM7XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiB1cGRhdGVUcmVlTm9kZShpZDogbnVtYmVyLCB1cGRhdGVzOiBVcGRhdGVUcmVlTm9kZVJlcXVlc3QpOiBQcm9taXNlPFRyZWVOb2RlIHwgbnVsbD4ge1xuICBjb25zdCBwZ0NsaWVudCA9IGdldFBnQ2xpZW50KCk7XG4gIGlmICghcGdDbGllbnQpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ1Bvc3RncmVTUUwg7YG065287J207Ja47Yq46rCAIOy0iOq4sO2ZlOuQmOyngCDslYrslZjsirXri4jri6QuJyk7XG4gIH1cblxuICBjb25zdCBzZXRDbGF1c2VzOiBzdHJpbmdbXSA9IFtdO1xuICBjb25zdCB2YWx1ZXM6IGFueVtdID0gW107XG4gIGxldCBwYXJhbUluZGV4ID0gMTtcblxuICBpZiAodXBkYXRlcy5uYW1lICE9PSB1bmRlZmluZWQpIHtcbiAgICBzZXRDbGF1c2VzLnB1c2goYG5hbWUgPSAkJHtwYXJhbUluZGV4Kyt9YCk7XG4gICAgdmFsdWVzLnB1c2godXBkYXRlcy5uYW1lKTtcbiAgfVxuXG4gIGlmICh1cGRhdGVzLnBhcmVudElkICE9PSB1bmRlZmluZWQpIHtcbiAgICBzZXRDbGF1c2VzLnB1c2goYHBhcmVudF9pZCA9ICQke3BhcmFtSW5kZXgrK31gKTtcbiAgICB2YWx1ZXMucHVzaCh1cGRhdGVzLnBhcmVudElkKTtcbiAgfVxuXG4gIGlmICh1cGRhdGVzLnNvcnRPcmRlciAhPT0gdW5kZWZpbmVkKSB7XG4gICAgc2V0Q2xhdXNlcy5wdXNoKGBzb3J0X29yZGVyID0gJCR7cGFyYW1JbmRleCsrfWApO1xuICAgIHZhbHVlcy5wdXNoKHVwZGF0ZXMuc29ydE9yZGVyKTtcbiAgfVxuXG4gIGlmIChzZXRDbGF1c2VzLmxlbmd0aCA9PT0gMCkge1xuICAgIHJldHVybiBnZXRUcmVlTm9kZUJ5SWQoaWQpO1xuICB9XG5cbiAgdmFsdWVzLnB1c2goaWQpO1xuICBjb25zdCBxdWVyeSA9IGBVUERBVEUgdHJlZV9ub2RlcyBTRVQgJHtzZXRDbGF1c2VzLmpvaW4oJywgJyl9IFdIRVJFIGlkID0gJCR7cGFyYW1JbmRleH0gUkVUVVJOSU5HICpgO1xuICBcbiAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcGdDbGllbnQucXVlcnkocXVlcnksIHZhbHVlcyk7XG4gIFxuICBpZiAocmVzdWx0LnJvd3MubGVuZ3RoID09PSAwKSB7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICBjb25zdCByb3cgPSByZXN1bHQucm93c1swXTtcbiAgcmV0dXJuIHtcbiAgICBpZDogcm93LmlkLFxuICAgIG5hbWU6IHJvdy5uYW1lLFxuICAgIHR5cGU6IHJvdy50eXBlLFxuICAgIHBhcmVudElkOiByb3cucGFyZW50X2lkLFxuICAgIHNvcnRPcmRlcjogcm93LnNvcnRfb3JkZXIsXG4gICAgY3JlYXRlZEF0OiByb3cuY3JlYXRlZF9hdCxcbiAgICB1cGRhdGVkQXQ6IHJvdy51cGRhdGVkX2F0LFxuICAgIGNyZWF0ZWRCeTogcm93LmNyZWF0ZWRfYnlcbiAgfTtcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGRlbGV0ZVRyZWVOb2RlKGlkOiBudW1iZXIpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgY29uc3QgcGdDbGllbnQgPSBnZXRQZ0NsaWVudCgpO1xuICBpZiAoIXBnQ2xpZW50KSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdQb3N0Z3JlU1FMIO2BtOudvOydtOyWuO2KuOqwgCDstIjquLDtmZTrkJjsp4Ag7JWK7JWY7Iq164uI64ukLicpO1xuICB9XG5cbiAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcGdDbGllbnQucXVlcnkoJ0RFTEVURSBGUk9NIHRyZWVfbm9kZXMgV0hFUkUgaWQgPSAkMSBSRVRVUk5JTkcgaWQnLCBbaWRdKTtcbiAgcmV0dXJuIHJlc3VsdC5yb3dzLmxlbmd0aCA+IDA7XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyDqsoDsg4kg7ZWo7IiYXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gc2VhcmNoVHJlZU5vZGVzKHJlcXVlc3Q6IFRyZWVTZWFyY2hSZXF1ZXN0KTogUHJvbWlzZTxUcmVlU2VhcmNoUmVzdWx0PiB7XG4gIGNvbnN0IHBnQ2xpZW50ID0gZ2V0UGdDbGllbnQoKTtcbiAgaWYgKCFwZ0NsaWVudCkge1xuICAgIHRocm93IG5ldyBFcnJvcignUG9zdGdyZVNRTCDtgbTrnbzsnbTslrjtirjqsIAg7LSI6riw7ZmU65CY7KeAIOyViuyVmOyKteuLiOuLpC4nKTtcbiAgfVxuXG4gIGxldCBxdWVyeSA9ICdTRUxFQ1QgKiBGUk9NIHRyZWVfbm9kZXMgV0hFUkUgMT0xJztcbiAgY29uc3QgdmFsdWVzOiBhbnlbXSA9IFtdO1xuICBsZXQgcGFyYW1JbmRleCA9IDE7XG5cbiAgaWYgKHJlcXVlc3QucXVlcnkpIHtcbiAgICBxdWVyeSArPSBgIEFORCBuYW1lIElMSUtFICQke3BhcmFtSW5kZXgrK31gO1xuICAgIHZhbHVlcy5wdXNoKGAlJHtyZXF1ZXN0LnF1ZXJ5fSVgKTtcbiAgfVxuXG4gIGlmIChyZXF1ZXN0LnR5cGUpIHtcbiAgICBxdWVyeSArPSBgIEFORCB0eXBlID0gJCR7cGFyYW1JbmRleCsrfWA7XG4gICAgdmFsdWVzLnB1c2gocmVxdWVzdC50eXBlKTtcbiAgfVxuXG4gIGlmIChyZXF1ZXN0LnBhcmVudElkICE9PSB1bmRlZmluZWQpIHtcbiAgICBxdWVyeSArPSBgIEFORCBwYXJlbnRfaWQgPSAkJHtwYXJhbUluZGV4Kyt9YDtcbiAgICB2YWx1ZXMucHVzaChyZXF1ZXN0LnBhcmVudElkKTtcbiAgfVxuXG4gIHF1ZXJ5ICs9ICcgT1JERVIgQlkgc29ydF9vcmRlciwgbmFtZSc7XG5cbiAgaWYgKHJlcXVlc3QubGltaXQpIHtcbiAgICBxdWVyeSArPSBgIExJTUlUICQke3BhcmFtSW5kZXgrK31gO1xuICAgIHZhbHVlcy5wdXNoKHJlcXVlc3QubGltaXQpO1xuICB9XG5cbiAgaWYgKHJlcXVlc3Qub2Zmc2V0KSB7XG4gICAgcXVlcnkgKz0gYCBPRkZTRVQgJCR7cGFyYW1JbmRleCsrfWA7XG4gICAgdmFsdWVzLnB1c2gocmVxdWVzdC5vZmZzZXQpO1xuICB9XG5cbiAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcGdDbGllbnQucXVlcnkocXVlcnksIHZhbHVlcyk7XG4gIFxuICBjb25zdCBub2RlcyA9IHJlc3VsdC5yb3dzLm1hcCgocm93OiBhbnkpID0+ICh7XG4gICAgaWQ6IHJvdy5pZCxcbiAgICBuYW1lOiByb3cubmFtZSxcbiAgICB0eXBlOiByb3cudHlwZSxcbiAgICBwYXJlbnRJZDogcm93LnBhcmVudF9pZCxcbiAgICBzb3J0T3JkZXI6IHJvdy5zb3J0X29yZGVyLFxuICAgIGNyZWF0ZWRBdDogcm93LmNyZWF0ZWRfYXQsXG4gICAgdXBkYXRlZEF0OiByb3cudXBkYXRlZF9hdCxcbiAgICBjcmVhdGVkQnk6IHJvdy5jcmVhdGVkX2J5XG4gIH0pKTtcblxuICAvLyDsoITssrQg6rCc7IiYIOyhsO2ajFxuICBsZXQgY291bnRRdWVyeSA9ICdTRUxFQ1QgQ09VTlQoKikgRlJPTSB0cmVlX25vZGVzIFdIRVJFIDE9MSc7XG4gIGNvbnN0IGNvdW50VmFsdWVzOiBhbnlbXSA9IFtdO1xuICBsZXQgY291bnRQYXJhbUluZGV4ID0gMTtcblxuICBpZiAocmVxdWVzdC5xdWVyeSkge1xuICAgIGNvdW50UXVlcnkgKz0gYCBBTkQgbmFtZSBJTElLRSAkJHtjb3VudFBhcmFtSW5kZXgrK31gO1xuICAgIGNvdW50VmFsdWVzLnB1c2goYCUke3JlcXVlc3QucXVlcnl9JWApO1xuICB9XG5cbiAgaWYgKHJlcXVlc3QudHlwZSkge1xuICAgIGNvdW50UXVlcnkgKz0gYCBBTkQgdHlwZSA9ICQke2NvdW50UGFyYW1JbmRleCsrfWA7XG4gICAgY291bnRWYWx1ZXMucHVzaChyZXF1ZXN0LnR5cGUpO1xuICB9XG5cbiAgaWYgKHJlcXVlc3QucGFyZW50SWQgIT09IHVuZGVmaW5lZCkge1xuICAgIGNvdW50UXVlcnkgKz0gYCBBTkQgcGFyZW50X2lkID0gJCR7Y291bnRQYXJhbUluZGV4Kyt9YDtcbiAgICBjb3VudFZhbHVlcy5wdXNoKHJlcXVlc3QucGFyZW50SWQpO1xuICB9XG5cbiAgY29uc3QgY291bnRSZXN1bHQgPSBhd2FpdCBwZ0NsaWVudC5xdWVyeShjb3VudFF1ZXJ5LCBjb3VudFZhbHVlcyk7XG4gIGNvbnN0IHRvdGFsID0gcGFyc2VJbnQoY291bnRSZXN1bHQucm93c1swXS5jb3VudCk7XG5cbiAgY29uc3QgaGFzTW9yZSA9IChyZXF1ZXN0Lm9mZnNldCB8fCAwKSArIG5vZGVzLmxlbmd0aCA8IHRvdGFsO1xuICByZXR1cm4geyBub2RlcywgdG90YWwsIGhhc01vcmUgfTtcbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIOuTnOuemOq3uCDslaQg65Oc66GtIOq0gOugqCDtlajsiJhcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBtb3ZlVHJlZU5vZGUobm9kZUlkOiBudW1iZXIsIG5ld1BhcmVudElkOiBudW1iZXIgfCBudWxsKTogUHJvbWlzZTxUcmVlTm9kZSB8IG51bGw+IHtcbiAgY29uc3QgcGdDbGllbnQgPSBnZXRQZ0NsaWVudCgpO1xuICBpZiAoIXBnQ2xpZW50KSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdQb3N0Z3JlU1FMIO2BtOudvOydtOyWuO2KuOqwgCDstIjquLDtmZTrkJjsp4Ag7JWK7JWY7Iq164uI64ukLicpO1xuICB9XG5cbiAgdHJ5IHtcbiAgICBhd2FpdCBwZ0NsaWVudC5xdWVyeSgnQkVHSU4nKTtcblxuICAgIC8vIOyDiCDrtoDrqqjsnZgg7LWc64yAIOyInOyEnCDsobDtmoxcbiAgICBsZXQgbmV3U29ydE9yZGVyID0gMDtcbiAgICBpZiAobmV3UGFyZW50SWQgIT09IG51bGwpIHtcbiAgICAgIGNvbnN0IG1heFNvcnRSZXN1bHQgPSBhd2FpdCBwZ0NsaWVudC5xdWVyeShcbiAgICAgICAgJ1NFTEVDVCBDT0FMRVNDRShNQVgoc29ydF9vcmRlciksIDApIGFzIG1heF9zb3J0IEZST00gdHJlZV9ub2RlcyBXSEVSRSBwYXJlbnRfaWQgPSAkMScsXG4gICAgICAgIFtuZXdQYXJlbnRJZF1cbiAgICAgICk7XG4gICAgICBuZXdTb3J0T3JkZXIgPSBtYXhTb3J0UmVzdWx0LnJvd3NbMF0ubWF4X3NvcnQgKyAxO1xuICAgIH1cblxuICAgIC8vIOuFuOuTnCDsnbTrj5lcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBwZ0NsaWVudC5xdWVyeShcbiAgICAgICdVUERBVEUgdHJlZV9ub2RlcyBTRVQgcGFyZW50X2lkID0gJDEsIHNvcnRfb3JkZXIgPSAkMiBXSEVSRSBpZCA9ICQzIFJFVFVSTklORyAqJyxcbiAgICAgIFtuZXdQYXJlbnRJZCwgbmV3U29ydE9yZGVyLCBub2RlSWRdXG4gICAgKTtcblxuICAgIGF3YWl0IHBnQ2xpZW50LnF1ZXJ5KCdDT01NSVQnKTtcbiAgICBcbiAgICBpZiAocmVzdWx0LnJvd3MubGVuZ3RoID09PSAwKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICBjb25zdCByb3cgPSByZXN1bHQucm93c1swXTtcbiAgICByZXR1cm4ge1xuICAgICAgaWQ6IHJvdy5pZCxcbiAgICAgIG5hbWU6IHJvdy5uYW1lLFxuICAgICAgdHlwZTogcm93LnR5cGUsXG4gICAgICBwYXJlbnRJZDogcm93LnBhcmVudF9pZCxcbiAgICAgIHNvcnRPcmRlcjogcm93LnNvcnRfb3JkZXIsXG4gICAgICBjcmVhdGVkQXQ6IHJvdy5jcmVhdGVkX2F0LFxuICAgICAgdXBkYXRlZEF0OiByb3cudXBkYXRlZF9hdCxcbiAgICAgIGNyZWF0ZWRCeTogcm93LmNyZWF0ZWRfYnlcbiAgICB9O1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGF3YWl0IHBnQ2xpZW50LnF1ZXJ5KCdST0xMQkFDSycpO1xuICAgIHRocm93IGVycm9yO1xuICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiByZW9yZGVyVHJlZU5vZGUobm9kZUlkOiBudW1iZXIsIHRhcmdldE5vZGVJZDogbnVtYmVyLCBwb3NpdGlvbjogJ2JlZm9yZScgfCAnYWZ0ZXInKTogUHJvbWlzZTxUcmVlTm9kZSB8IG51bGw+IHtcbiAgY29uc3QgcGdDbGllbnQgPSBnZXRQZ0NsaWVudCgpO1xuICBpZiAoIXBnQ2xpZW50KSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdQb3N0Z3JlU1FMIO2BtOudvOydtOyWuO2KuOqwgCDstIjquLDtmZTrkJjsp4Ag7JWK7JWY7Iq164uI64ukLicpO1xuICB9XG5cbiAgdHJ5IHtcbiAgICBhd2FpdCBwZ0NsaWVudC5xdWVyeSgnQkVHSU4nKTtcblxuICAgIC8vIO2YhOyerCDrhbjrk5zsmYAg64yA7IOBIOuFuOuTnCDsoJXrs7Qg7KGw7ZqMXG4gICAgY29uc3QgZHJhZ2dlZE5vZGUgPSBhd2FpdCBnZXRUcmVlTm9kZUJ5SWQobm9kZUlkKTtcbiAgICBjb25zdCB0YXJnZXROb2RlID0gYXdhaXQgZ2V0VHJlZU5vZGVCeUlkKHRhcmdldE5vZGVJZCk7XG5cbiAgICBpZiAoIWRyYWdnZWROb2RlIHx8ICF0YXJnZXROb2RlKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ+uFuOuTnOulvCDssL7snYQg7IiYIOyXhuyKteuLiOuLpC4nKTtcbiAgICB9XG5cbiAgICAvLyDqsJnsnYAg67aA66qoIOuFuOuTnCDrgrTsl5DshJzrp4wg7Iic7IScIOuzgOqyvSDqsIDriqVcbiAgICBpZiAoZHJhZ2dlZE5vZGUucGFyZW50SWQgIT09IHRhcmdldE5vZGUucGFyZW50SWQpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcign6rCZ7J2AIOu2gOuqqCDrhbjrk5wg64K07JeQ7ISc66eMIOyInOyEnCDrs4Dqsr3snbQg6rCA64ql7ZWp64uI64ukLicpO1xuICAgIH1cblxuICAgIC8vIOuMgOyDgSDrhbjrk5zsnZgg7ZiE7J6sIOyInOyEnCDsobDtmoxcbiAgICBjb25zdCB0YXJnZXRTb3J0T3JkZXIgPSB0YXJnZXROb2RlLnNvcnRPcmRlciB8fCAwO1xuXG4gICAgLy8g7IOI66Gc7Jq0IOyInOyEnCDqs4TsgrBcbiAgICBsZXQgbmV3U29ydE9yZGVyOiBudW1iZXI7XG4gICAgaWYgKHBvc2l0aW9uID09PSAnYmVmb3JlJykge1xuICAgICAgbmV3U29ydE9yZGVyID0gdGFyZ2V0U29ydE9yZGVyO1xuICAgICAgLy8g64yA7IOBIOuFuOuTnOyZgCDqt7gg7J207ZuEIOuFuOuTnOuTpOydmCDsiJzshJzrpbwgMeyUqSDspp3qsIBcbiAgICAgIGF3YWl0IHBnQ2xpZW50LnF1ZXJ5KFxuICAgICAgICAnVVBEQVRFIHRyZWVfbm9kZXMgU0VUIHNvcnRfb3JkZXIgPSBzb3J0X29yZGVyICsgMSBXSEVSRSBwYXJlbnRfaWQgPSAkMSBBTkQgc29ydF9vcmRlciA+PSAkMicsXG4gICAgICAgIFt0YXJnZXROb2RlLnBhcmVudElkLCB0YXJnZXRTb3J0T3JkZXJdXG4gICAgICApO1xuICAgIH0gZWxzZSB7XG4gICAgICBuZXdTb3J0T3JkZXIgPSB0YXJnZXRTb3J0T3JkZXIgKyAxO1xuICAgICAgLy8g64yA7IOBIOuFuOuTnCDsnbTtm4Qg64W465Oc65Ok7J2YIOyInOyEnOulvCAx7JSpIOymneqwgFxuICAgICAgYXdhaXQgcGdDbGllbnQucXVlcnkoXG4gICAgICAgICdVUERBVEUgdHJlZV9ub2RlcyBTRVQgc29ydF9vcmRlciA9IHNvcnRfb3JkZXIgKyAxIFdIRVJFIHBhcmVudF9pZCA9ICQxIEFORCBzb3J0X29yZGVyID4gJDInLFxuICAgICAgICBbdGFyZ2V0Tm9kZS5wYXJlbnRJZCwgdGFyZ2V0U29ydE9yZGVyXVxuICAgICAgKTtcbiAgICB9XG5cbiAgICAvLyDrk5zrnpjqt7jtlZwg64W465Oc7J2YIOyInOyEnCDsl4XrjbDsnbTtirhcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBwZ0NsaWVudC5xdWVyeShcbiAgICAgICdVUERBVEUgdHJlZV9ub2RlcyBTRVQgc29ydF9vcmRlciA9ICQxIFdIRVJFIGlkID0gJDIgUkVUVVJOSU5HIConLFxuICAgICAgW25ld1NvcnRPcmRlciwgbm9kZUlkXVxuICAgICk7XG5cbiAgICBhd2FpdCBwZ0NsaWVudC5xdWVyeSgnQ09NTUlUJyk7XG4gICAgXG4gICAgaWYgKHJlc3VsdC5yb3dzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgY29uc3Qgcm93ID0gcmVzdWx0LnJvd3NbMF07XG4gICAgcmV0dXJuIHtcbiAgICAgIGlkOiByb3cuaWQsXG4gICAgICBuYW1lOiByb3cubmFtZSxcbiAgICAgIHR5cGU6IHJvdy50eXBlLFxuICAgICAgcGFyZW50SWQ6IHJvdy5wYXJlbnRfaWQsXG4gICAgICBzb3J0T3JkZXI6IHJvdy5zb3J0X29yZGVyLFxuICAgICAgY3JlYXRlZEF0OiByb3cuY3JlYXRlZF9hdCxcbiAgICAgIHVwZGF0ZWRBdDogcm93LnVwZGF0ZWRfYXQsXG4gICAgICBjcmVhdGVkQnk6IHJvdy5jcmVhdGVkX2J5XG4gICAgfTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBhd2FpdCBwZ0NsaWVudC5xdWVyeSgnUk9MTEJBQ0snKTtcbiAgICB0aHJvdyBlcnJvcjtcbiAgfVxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8g7Jyg7Zqo7ISxIOqygOyCrCDtlajsiJhcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjaGVja0NpcmN1bGFyUmVmZXJlbmNlKG5vZGVJZDogbnVtYmVyLCBuZXdQYXJlbnRJZDogbnVtYmVyKTogUHJvbWlzZTxib29sZWFuPiB7XG4gIGNvbnN0IHBnQ2xpZW50ID0gZ2V0UGdDbGllbnQoKTtcbiAgaWYgKCFwZ0NsaWVudCkge1xuICAgIHRocm93IG5ldyBFcnJvcignUG9zdGdyZVNRTCDtgbTrnbzsnbTslrjtirjqsIAg7LSI6riw7ZmU65CY7KeAIOyViuyVmOyKteuLiOuLpC4nKTtcbiAgfVxuXG4gIC8vIOyekOq4sCDsnpDsi6DsnYQg67aA66qo66GcIOyEpOygle2VmOuKlCDqsr3smrBcbiAgaWYgKG5vZGVJZCA9PT0gbmV3UGFyZW50SWQpIHtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuXG4gIC8vIOuwmOuzteusuOycvOuhnCDsiJztmZgg7LC47KGwIOqygOyCrCAo7J6s6reAIOuMgOyLoClcbiAgY29uc3QgdmlzaXRlZCA9IG5ldyBTZXQ8bnVtYmVyPigpO1xuICBsZXQgY3VycmVudElkID0gbmV3UGFyZW50SWQ7XG5cbiAgd2hpbGUgKGN1cnJlbnRJZCAhPT0gbnVsbCkge1xuICAgIC8vIOydtOuvuCDrsKnrrLjtlZwgSUTqsIAg7J6I64uk66m0IOyInO2ZmCDssLjsobBcbiAgICBpZiAodmlzaXRlZC5oYXMoY3VycmVudElkKSkge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuXG4gICAgdmlzaXRlZC5hZGQoY3VycmVudElkKTtcblxuICAgIC8vIO2YhOyerCBJROqwgCDsnbTrj5ntlZjroKTripQg64W465Oc7JmAIOqwmeuLpOuptCDsiJztmZgg7LC47KGwXG4gICAgaWYgKGN1cnJlbnRJZCA9PT0gbm9kZUlkKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG5cbiAgICAvLyDrtoDrqqggSUQg7KGw7ZqMXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcGdDbGllbnQucXVlcnkoJ1NFTEVDVCBwYXJlbnRfaWQgRlJPTSB0cmVlX25vZGVzIFdIRVJFIGlkID0gJDEnLCBbY3VycmVudElkXSk7XG4gICAgY29uc3QgcGFyZW50SWQgPSByZXN1bHQucm93c1swXT8ucGFyZW50X2lkO1xuXG4gICAgaWYgKCFwYXJlbnRJZCkge1xuICAgICAgYnJlYWs7IC8vIOujqO2KuOyXkCDrj4Tri6xcbiAgICB9XG5cbiAgICBjdXJyZW50SWQgPSBwYXJlbnRJZDtcbiAgfVxuXG4gIHJldHVybiBmYWxzZTtcbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIO2eiOyKpO2GoOumrCDqtIDroKgg7ZWo7IiYXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gcmVjb3JkVHJlZU5vZGVNb3ZlKGhpc3Rvcnk6IHtcbiAgbm9kZUlkOiBudW1iZXI7XG4gIG9sZFBhcmVudElkOiBudW1iZXIgfCBudWxsO1xuICBuZXdQYXJlbnRJZDogbnVtYmVyIHwgbnVsbDtcbiAgb2xkU29ydE9yZGVyOiBudW1iZXI7XG4gIG5ld1NvcnRPcmRlcjogbnVtYmVyO1xuICBtb3ZlZEJ5OiBzdHJpbmc7XG59KTogUHJvbWlzZTx2b2lkPiB7XG4gIGNvbnN0IHBnQ2xpZW50ID0gZ2V0UGdDbGllbnQoKTtcbiAgaWYgKCFwZ0NsaWVudCkge1xuICAgIHRocm93IG5ldyBFcnJvcignUG9zdGdyZVNRTCDtgbTrnbzsnbTslrjtirjqsIAg7LSI6riw7ZmU65CY7KeAIOyViuyVmOyKteuLiOuLpC4nKTtcbiAgfVxuXG4gIGF3YWl0IHBnQ2xpZW50LnF1ZXJ5KFxuICAgICdJTlNFUlQgSU5UTyB0cmVlX25vZGVfbW92ZV9oaXN0b3J5IChub2RlX2lkLCBvbGRfcGFyZW50X2lkLCBuZXdfcGFyZW50X2lkLCBvbGRfc29ydF9vcmRlciwgbmV3X3NvcnRfb3JkZXIsIG1vdmVkX2J5KSBWQUxVRVMgKCQxLCAkMiwgJDMsICQ0LCAkNSwgJDYpJyxcbiAgICBbaGlzdG9yeS5ub2RlSWQsIGhpc3Rvcnkub2xkUGFyZW50SWQsIGhpc3RvcnkubmV3UGFyZW50SWQsIGhpc3Rvcnkub2xkU29ydE9yZGVyLCBoaXN0b3J5Lm5ld1NvcnRPcmRlciwgaGlzdG9yeS5tb3ZlZEJ5XVxuICApO1xufSAiXSwidmVyc2lvbiI6M30=