9e75d7337a789a861393b75aa3373cb8
"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
// 모킹 설정 - 올바른 경로 사용
jest.mock('../src/main/app/infrastructure/database/pgClient', () => ({
    query: jest.fn().mockResolvedValue({ rows: [] }),
    connect: jest.fn().mockResolvedValue({}),
}));
jest.mock('../src/main/app/infrastructure/elasticsearch/esClient', () => ({
    search: jest.fn().mockResolvedValue({ hits: { hits: [] } }),
    index: jest.fn().mockResolvedValue({}),
}));
const util_1 = require("util");
global.TextEncoder = util_1.TextEncoder;
global.TextDecoder = util_1.TextDecoder;
// ClearImmediate 폴리필 추가
if (typeof global.clearImmediate === 'undefined') {
    global.clearImmediate = jest.fn();
}
if (typeof global.ReadableStream === 'undefined') {
    global.ReadableStream = require('stream').Readable;
}
if (typeof global.setImmediate === 'undefined') {
    global.setImmediate = (fn, ...args) => setTimeout(fn, 0, ...args);
}
const supertest_1 = __importDefault(require("supertest"));
const app_1 = __importDefault(require("../src/main/app/app"));
// 테스트용 fixture 데이터 - 스키마에 맞게 수정
const TESTCASE_ID = 1;
const RELEASE_ID = 1; // ✅ 추가: 필수 필드
const EXECUTED_BY = 'testuser';
let executionId;
describe('Execution API', () => {
    beforeEach(() => {
        // 각 테스트 전에 모킹 초기화
        jest.clearAllMocks();
        // PostgreSQL 모킹 설정 - 스키마에 맞게 수정
        const { query } = require('../src/main/app/infrastructure/database/pgClient');
        query.mockImplementation((sql, params) => {
            if (sql.includes('INSERT INTO executions')) {
                return Promise.resolve({ rows: [{ id: 1 }] });
            }
            if (sql.includes('SELECT * FROM executions')) {
                return Promise.resolve({
                    rows: [{
                            id: 1,
                            testcase_id: TESTCASE_ID,
                            release_id: RELEASE_ID, // ✅ 추가: 필수 필드
                            status: 'Fail',
                            executed_by: EXECUTED_BY,
                            executed_at: new Date().toISOString(),
                            comment: '테스트 실패'
                            // repro_steps 제거 - API에서 지원하지 않음
                        }]
                });
            }
            if (sql.includes('UPDATE executions')) {
                return Promise.resolve({ rows: [{ id: 1, status: 'Pass', comment: '수정됨' }] });
            }
            if (sql.includes('DELETE FROM executions')) {
                return Promise.resolve({ rows: [] });
            }
            return Promise.resolve({ rows: [] });
        });
    });
    it('should create an execution', async () => {
        const res = await (0, supertest_1.default)(app_1.default)
            .post('/api/executions')
            .send({
            testcaseId: TESTCASE_ID,
            releaseId: RELEASE_ID, // ✅ 추가: 필수 필드
            status: 'Fail',
            executedBy: EXECUTED_BY,
            executedAt: new Date().toISOString(),
            comment: '테스트 실패',
            // reproSteps 제거 - API에서 지원하지 않음
        });
        expect(res.status).toBe(201);
        expect(res.body).toHaveProperty('id');
        executionId = res.body.id;
    }, 60000);
    it('should get execution by id', async () => {
        const res = await (0, supertest_1.default)(app_1.default).get(`/api/executions/${executionId}`);
        expect(res.status).toBe(200);
        expect(res.body.id).toBe(executionId);
    }, 60000);
    it('should get executions by testcase', async () => {
        const res = await (0, supertest_1.default)(app_1.default).get(`/api/executions/testcase/${TESTCASE_ID}`);
        expect(res.status).toBe(200);
        expect(Array.isArray(res.body)).toBe(true);
    }, 60000);
    it('should update execution', async () => {
        const res = await (0, supertest_1.default)(app_1.default)
            .put(`/api/executions/${executionId}`)
            .send({ status: 'Pass', comment: '수정됨' });
        expect(res.status).toBe(200);
        expect(res.body.status).toBe('Pass');
        expect(res.body.comment).toBe('수정됨');
    }, 60000);
    it('should delete execution', async () => {
        const res = await (0, supertest_1.default)(app_1.default).delete(`/api/executions/${executionId}`);
        expect(res.status).toBe(204);
    }, 60000);
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzLzNpLWExLTIwMjEtMDE3L0RvY3VtZW50cy9xdWVzdC9EZXNrdG9wL3F1ZXN0L3Rlc3RzL2V4ZWN1dGlvbi5hcGkudGVzdC50cyIsIm1hcHBpbmdzIjoiOzs7OztBQW1CQSxvQkFBb0I7QUFDcEIsSUFBSSxDQUFDLElBQUksQ0FBQyxrREFBa0QsRUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFDO0lBQ25FLEtBQUssRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsaUJBQWlCLENBQUMsRUFBRSxJQUFJLEVBQUUsRUFBRSxFQUFFLENBQUM7SUFDaEQsT0FBTyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxpQkFBaUIsQ0FBQyxFQUFFLENBQUM7Q0FDekMsQ0FBQyxDQUFDLENBQUM7QUFFSixJQUFJLENBQUMsSUFBSSxDQUFDLHVEQUF1RCxFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUM7SUFDeEUsTUFBTSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxpQkFBaUIsQ0FBQyxFQUFFLElBQUksRUFBRSxFQUFFLElBQUksRUFBRSxFQUFFLEVBQUUsRUFBRSxDQUFDO0lBQzNELEtBQUssRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsaUJBQWlCLENBQUMsRUFBRSxDQUFDO0NBQ3ZDLENBQUMsQ0FBQyxDQUFDO0FBNUJKLCtCQUFnRDtBQUMvQyxNQUFjLENBQUMsV0FBVyxHQUFHLGtCQUFXLENBQUM7QUFDekMsTUFBYyxDQUFDLFdBQVcsR0FBRyxrQkFBVyxDQUFDO0FBRTFDLHdCQUF3QjtBQUN4QixJQUFJLE9BQVEsTUFBYyxDQUFDLGNBQWMsS0FBSyxXQUFXLEVBQUUsQ0FBQztJQUN6RCxNQUFjLENBQUMsY0FBYyxHQUFHLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQztBQUM3QyxDQUFDO0FBRUQsSUFBSSxPQUFRLE1BQWMsQ0FBQyxjQUFjLEtBQUssV0FBVyxFQUFFLENBQUM7SUFDekQsTUFBYyxDQUFDLGNBQWMsR0FBRyxPQUFPLENBQUMsUUFBUSxDQUFDLENB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LENBQUM7SUFFVixFQUFFLENBQUMseUJBQXlCLEVBQUUsS0FBSyxJQUFJLEVBQUU7UUFDckMsTUFBTSxHQUFHLEdBQUcsTUFBTSxJQUFBLG1CQUFPLEVBQUMsYUFBRyxDQUFDO2FBQ3pCLEdBQUcsQ0FBQyxtQkFBbUIsV0FBVyxFQUFFLENBQUM7YUFDckMsSUFBSSxDQUFDLEVBQUUsTUFBTSxFQUFFLE1BQU0sRUFBRSxPQUFPLEVBQUUsS0FBSyxFQUFFLENBQUMsQ0FBQztRQUM5QyxNQUFNLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUM3QixNQUFNLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDckMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQ3pDLENBQUMsRUFBRSxLQUFLLENBQUMsQ0FBQztJQUVWLEVBQUUsQ0FBQyx5QkFBeUIsRUFBRSxLQUFLLElBQUksRUFBRTtRQUNyQyxNQUFNLEdBQUcsR0FBRyxNQUFNLElBQUEsbUJBQU8sRUFBQyxhQUFHLENBQUMsQ0FBQyxNQUFNLENBQUMsbUJBQW1CLFdBQVcsRUFBRSxDQUFDLENBQUM7UUFDeEUsTUFBTSxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDakMsQ0FBQyxFQUFFLEtBQUssQ0FBQyxDQUFDO0FBQ2QsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzLzNpLWExLTIwMjEtMDE3L0RvY3VtZW50cy9xdWVzdC9EZXNrdG9wL3F1ZXN0L3Rlc3RzL2V4ZWN1dGlvbi5hcGkudGVzdC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBUZXh0RW5jb2RlciwgVGV4dERlY29kZXIgfSBmcm9tICd1dGlsJztcbihnbG9iYWwgYXMgYW55KS5UZXh0RW5jb2RlciA9IFRleHRFbmNvZGVyO1xuKGdsb2JhbCBhcyBhbnkpLlRleHREZWNvZGVyID0gVGV4dERlY29kZXI7XG5cbi8vIENsZWFySW1tZWRpYXRlIO2PtOumrO2VhCDstpTqsIBcbmlmICh0eXBlb2YgKGdsb2JhbCBhcyBhbnkpLmNsZWFySW1tZWRpYXRlID09PSAndW5kZWZpbmVkJykge1xuICAoZ2xvYmFsIGFzIGFueSkuY2xlYXJJbW1lZGlhdGUgPSBqZXN0LmZuKCk7XG59XG5cbmlmICh0eXBlb2YgKGdsb2JhbCBhcyBhbnkpLlJlYWRhYmxlU3RyZWFtID09PSAndW5kZWZpbmVkJykge1xuICAoZ2xvYmFsIGFzIGFueSkuUmVhZGFibGVTdHJlYW0gPSByZXF1aXJlKCdzdHJlYW0nKS5SZWFkYWJsZTtcbn1cbmlmICh0eXBlb2YgKGdsb2JhbCBhcyBhbnkpLnNldEltbWVkaWF0ZSA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgKGdsb2JhbCBhcyBhbnkpLnNldEltbWVkaWF0ZSA9IChmbjogYW55LCAuLi5hcmdzOiBhbnlbXSkgPT4gc2V0VGltZW91dChmbiwgMCwgLi4uYXJncyk7XG59XG5cbmltcG9ydCByZXF1ZXN0IGZyb20gJ3N1cGVydGVzdCc7XG5pbXBvcnQgYXBwIGZyb20gJy4uL3NyYy9tYWluL2FwcC9hcHAnO1xuXG4vLyDrqqjtgrkg7ISk7KCVIC0g7Jis67CU66W4IOqyveuhnCDsgqzsmqlcbmplc3QubW9jaygnLi4vc3JjL21haW4vYXBwL2luZnJhc3RydWN0dXJlL2RhdGFiYXNlL3BnQ2xpZW50JywgKCkgPT4gKHtcbiAgcXVlcnk6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7IHJvd3M6IFtdIH0pLFxuICBjb25uZWN0OiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoe30pLFxufSkpO1xuXG5qZXN0Lm1vY2soJy4uL3NyYy9tYWluL2FwcC9pbmZyYXN0cnVjdHVyZS9lbGFzdGljc2VhcmNoL2VzQ2xpZW50JywgKCkgPT4gKHtcbiAgc2VhcmNoOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoeyBoaXRzOiB7IGhpdHM6IFtdIH0gfSksXG4gIGluZGV4OiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoe30pLFxufSkpO1xuXG4vLyDthYzsiqTtirjsmqkgZml4dHVyZSDrjbDsnbTthLAgLSDsiqTtgqTrp4jsl5Ag66ee6rKMIOyImOyglVxuY29uc3QgVEVTVENBU0VfSUQgPSAxO1xuY29uc3QgUkVMRUFTRV9JRCA9IDE7IC8vIOKchSDstpTqsIA6IO2VhOyImCDtlYTrk5xcbmNvbnN0IEVYRUNVVEVEX0JZID0gJ3Rlc3R1c2VyJztcblxubGV0IGV4ZWN1dGlvbklkOiBudW1iZXI7XG5cbmRlc2NyaWJlKCdFeGVjdXRpb24gQVBJJywgKCkgPT4ge1xuICAgIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgICAgICAvLyDqsIEg7YWM7Iqk7Yq4IOyghOyXkCDrqqjtgrkg7LSI6riw7ZmUXG4gICAgICAgIGplc3QuY2xlYXJBbGxNb2NrcygpO1xuICAgICAgICBcbiAgICAgICAgLy8gUG9zdGdyZVNRTCDrqqjtgrkg7ISk7KCVIC0g7Iqk7YKk66eI7JeQIOunnuqyjCDsiJjsoJVcbiAgICAgICAgY29uc3QgeyBxdWVyeSB9ID0gcmVxdWlyZSgnLi4vc3JjL21haW4vYXBwL2luZnJhc3RydWN0dXJlL2RhdGFiYXNlL3BnQ2xpZW50Jyk7XG4gICAgICAgIHF1ZXJ5Lm1vY2tJbXBsZW1lbnRhdGlvbigoc3FsOiBzdHJpbmcsIHBhcmFtczogYW55W10pID0+IHtcbiAgICAgICAgICBpZiAoc3FsLmluY2x1ZGVzKCdJTlNFUlQgSU5UTyBleGVjdXRpb25zJykpIHtcbiAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoeyByb3dzOiBbeyBpZDogMSB9XSB9KTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKHNxbC5pbmNsdWRlcygnU0VMRUNUICogRlJPTSBleGVjdXRpb25zJykpIHtcbiAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoeyBcbiAgICAgICAgICAgICAgcm93czogW3sgXG4gICAgICAgICAgICAgICAgaWQ6IDEsIFxuICAgICAgICAgICAgICAgIHRlc3RjYXNlX2lkOiBURVNUQ0FTRV9JRCxcbiAgICAgICAgICAgICAgICByZWxlYXNlX2lkOiBSRUxFQVNFX0lELCAvLyDinIUg7LaU6rCAOiDtlYTsiJgg7ZWE65OcXG4gICAgICAgICAgICAgICAgc3RhdHVzOiAnRmFpbCcsIFxuICAgICAgICAgICAgICAgIGV4ZWN1dGVkX2J5OiBFWEVDVVRFRF9CWSxcbiAgICAgICAgICAgICAgICBleGVjdXRlZF9hdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgICAgICAgICAgICAgIGNvbW1lbnQ6ICfthYzsiqTtirgg7Iuk7YyoJ1xuICAgICAgICAgICAgICAgIC8vIHJlcHJvX3N0ZXBzIOygnOqxsCAtIEFQSeyXkOyEnCDsp4Dsm5DtlZjsp4Ag7JWK7J2MXG4gICAgICAgICAgICAgIH1dIFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChzcWwuaW5jbHVkZXMoJ1VQREFURSBleGVjdXRpb25zJykpIHtcbiAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoeyByb3dzOiBbeyBpZDogMSwgc3RhdHVzOiAnUGFzcycsIGNvbW1lbnQ6ICfsiJjsoJXrkKgnIH1dIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoc3FsLmluY2x1ZGVzKCdERUxFVEUgRlJPTSBleGVjdXRpb25zJykpIHtcbiAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoeyByb3dzOiBbXSB9KTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSh7IHJvd3M6IFtdIH0pO1xuICAgICAgICB9KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgY3JlYXRlIGFuIGV4ZWN1dGlvbicsIGFzeW5jICgpID0+IHtcbiAgICAgICAgY29uc3QgcmVzID0gYXdhaXQgcmVxdWVzdChhcHApXG4gICAgICAgICAgICAucG9zdCgnL2FwaS9leGVjdXRpb25zJylcbiAgICAgICAgICAgIC5zZW5kKHtcbiAgICAgICAgICAgICAgICB0ZXN0Y2FzZUlkOiBURVNUQ0FTRV9JRCxcbiAgICAgICAgICAgICAgICByZWxlYXNlSWQ6IFJFTEVBU0VfSUQsIC8vIOKchSDstpTqsIA6IO2VhOyImCDtlYTrk5xcbiAgICAgICAgICAgICAgICBzdGF0dXM6ICdGYWlsJyxcbiAgICAgICAgICAgICAgICBleGVjdXRlZEJ5OiBFWEVDVVRFRF9CWSxcbiAgICAgICAgICAgICAgICBleGVjdXRlZEF0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgY29tbWVudDogJ+2FjOyKpO2KuCDsi6TtjKgnLFxuICAgICAgICAgICAgICAgIC8vIHJlcHJvU3RlcHMg7KCc6rGwIC0gQVBJ7JeQ7IScIOyngOybkO2VmOyngCDslYrsnYxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICBleHBlY3QocmVzLnN0YXR1cykudG9CZSgyMDEpO1xuICAgICAgICBleHBlY3QocmVzLmJvZHkpLnRvSGF2ZVByb3BlcnR5KCdpZCcpO1xuICAgICAgICBleGVjdXRpb25JZCA9IHJlcy5ib2R5LmlkO1xuICAgIH0sIDYwMDAwKTtcblxuICAgIGl0KCdzaG91bGQgZ2V0IGV4ZWN1dGlvbiBieSBpZCcsIGFzeW5jICgpID0+IHtcbiAgICAgICAgY29uc3QgcmVzID0gYXdhaXQgcmVxdWVzdChhcHApLmdldChgL2FwaS9leGVjdXRpb25zLyR7ZXhlY3V0aW9uSWR9YCk7XG4gICAgICAgIGV4cGVjdChyZXMuc3RhdHVzKS50b0JlKDIwMCk7XG4gICAgICAgIGV4cGVjdChyZXMuYm9keS5pZCkudG9CZShleGVjdXRpb25JZCk7XG4gICAgfSwgNjAwMDApO1xuXG4gICAgaXQoJ3Nob3VsZCBnZXQgZXhlY3V0aW9ucyBieSB0ZXN0Y2FzZScsIGFzeW5jICgpID0+IHtcbiAgICAgICAgY29uc3QgcmVzID0gYXdhaXQgcmVxdWVzdChhcHApLmdldChgL2FwaS9leGVjdXRpb25zL3Rlc3RjYXNlLyR7VEVTVENBU0VfSUR9YCk7XG4gICAgICAgIGV4cGVjdChyZXMuc3RhdHVzKS50b0JlKDIwMCk7XG4gICAgICAgIGV4cGVjdChBcnJheS5pc0FycmF5KHJlcy5ib2R5KSkudG9CZSh0cnVlKTtcbiAgICB9LCA2MDAwMCk7XG5cbiAgICBpdCgnc2hvdWxkIHVwZGF0ZSBleGVjdXRpb24nLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IHJlcXVlc3QoYXBwKVxuICAgICAgICAgICAgLnB1dChgL2FwaS9leGVjdXRpb25zLyR7ZXhlY3V0aW9uSWR9YClcbiAgICAgICAgICAgIC5zZW5kKHsgc3RhdHVzOiAnUGFzcycsIGNvbW1lbnQ6ICfsiJjsoJXrkKgnIH0pO1xuICAgICAgICBleHBlY3QocmVzLnN0YXR1cykudG9CZSgyMDApO1xuICAgICAgICBleHBlY3QocmVzLmJvZHkuc3RhdHVzKS50b0JlKCdQYXNzJyk7XG4gICAgICAgIGV4cGVjdChyZXMuYm9keS5jb21tZW50KS50b0JlKCfsiJjsoJXrkKgnKTtcbiAgICB9LCA2MDAwMCk7XG5cbiAgICBpdCgnc2hvdWxkIGRlbGV0ZSBleGVjdXRpb24nLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IHJlcXVlc3QoYXBwKS5kZWxldGUoYC9hcGkvZXhlY3V0aW9ucy8ke2V4ZWN1dGlvbklkfWApO1xuICAgICAgICBleHBlY3QocmVzLnN0YXR1cykudG9CZSgyMDQpO1xuICAgIH0sIDYwMDAwKTtcbn0pOyAiXSwidmVyc2lvbiI6M30=