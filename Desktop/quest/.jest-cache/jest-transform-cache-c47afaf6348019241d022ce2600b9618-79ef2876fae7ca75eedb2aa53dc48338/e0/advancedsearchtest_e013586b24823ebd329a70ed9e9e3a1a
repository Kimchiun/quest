86a6b68dab605a3cf3d86c7e3a2eabd6
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
// Mock Elasticsearch client
jest.mock('../src/main/app/infrastructure/elasticsearch/esClient', () => ({
    search: jest.fn(),
    index: jest.fn(),
    delete: jest.fn(),
}));
const advancedSearchService_1 = require("../src/main/app/domains/testcases/elasticsearch/advancedSearchService");
describe('Advanced Search Service', () => {
    beforeEach(() => {
        jest.clearAllMocks();
    });
    describe('buildAdvancedQuery', () => {
        it('should build basic query without filters', () => {
            const filters = {};
            const query = (0, advancedSearchService_1.buildAdvancedQuery)(filters);
            expect(query.query.bool.must).toEqual([]);
            expect(query.query.bool.should).toEqual([]);
            expect(query.query.bool.filter).toEqual([]);
            expect(query.query.bool.minimum_should_match).toBe(0);
        });
        it('should build query with keyword search', () => {
            const filters = {
                keyword: 'login test'
            };
            const query = (0, advancedSearchService_1.buildAdvancedQuery)(filters);
            expect(query.query.bool.should).toHaveLength(4);
            expect(query.query.bool.should[0]).toEqual({
                match: { title: { query: 'login test', boost: 3 } }
            });
            expect(query.query.bool.minimum_should_match).toBe(1);
        });
        it('should build query with multiple filters', () => {
            const filters = {
                keyword: 'test',
                folders: ['Smoke Tests'],
                tags: ['critical'],
                status: ['Active'],
                priority: ['High'],
                createdBy: ['tester1'],
                dateRange: {
                    from: '2024-01-01',
                    to: '2024-12-31'
                }
            };
            const query = (0, advancedSearchService_1.buildAdvancedQuery)(filters);
            // 키워드 검색
            expect(query.query.bool.should).toHaveLength(4);
            expect(query.query.bool.minimum_should_match).toBe(1);
            // 필터 조건들 (날짜 범위 포함)
            expect(query.query.bool.filter).toHaveLength(6);
            expect(query.query.bool.filter).toContainEqual({
                terms: { folder: ['Smoke Tests'] }
            });
            expect(query.query.bool.filter).toContainEqual({
                terms: { tags: ['critical'] }
            });
            expect(query.query.bool.filter).toContainEqual({
                terms: { status: ['Active'] }
            });
            expect(query.query.bool.filter).toContainEqual({
                terms: { priority: ['High'] }
            });
            expect(query.query.bool.filter).toContainEqual({
                terms: { createdBy: ['tester1'] }
            });
            expect(query.query.bool.filter).toContainEqual({
                range: { createdAt: { gte: '2024-01-01', lte: '2024-12-31' } }
            });
        });
        it('should build query with date range filters', () => {
            const filters = {
                dateRange: {
                    from: '2024-01-01',
                    to: '2024-12-31'
                }
            };
            const query = (0, advancedSearchService_1.buildAdvancedQuery)(filters);
            expect(query.query.bool.filter).toContainEqual({
                range: { createdAt: { gte: '2024-01-01', lte: '2024-12-31' } }
            });
        });
        it('should build query with only from date', () => {
            const filters = {
                dateRange: {
                    from: '2024-01-01',
                    to: ''
                }
            };
            const query = (0, advancedSearchService_1.buildAdvancedQuery)(filters);
            expect(query.query.bool.filter).toContainEqual({
                range: { createdAt: { gte: '2024-01-01' } }
            });
        });
        it('should build query with only to date', () => {
            const filters = {
                dateRange: {
                    from: '',
                    to: '2024-12-31'
                }
            };
            const query = (0, advancedSearchService_1.buildAdvancedQuery)(filters);
            expect(query.query.bool.filter).toContainEqual({
                range: { createdAt: { lte: '2024-12-31' } }
            });
        });
    });
    describe('advancedSearch', () => {
        it('should execute advanced search and return results', async () => {
            const mockSearchResult = {
                hits: {
                    hits: [
                        {
                            _id: '1',
                            _source: {
                                id: 1,
                                title: 'Login Test',
                                priority: 'High',
                                status: 'Active',
                                createdBy: 'tester1',
                                createdAt: '2024-01-15T00:00:00Z'
                            },
                            highlight: {
                                title: ['<mark>Login</mark> Test']
                            }
                        }
                    ],
                    total: { value: 1 }
                }
            };
            const esClient = require('../src/main/app/infrastructure/elasticsearch/esClient');
            esClient.search.mockResolvedValue(mockSearchResult);
            const filters = {
                keyword: 'login',
                status: ['Active']
            };
            const result = await (0, advancedSearchService_1.advancedSearch)(filters, 0, 20);
            expect(result.testCases).toHaveLength(1);
            expect(result.testCases[0].title).toBe('Login Test');
            expect(result.total).toBe(1);
            expect(result.highlights['1']).toEqual(['<mark>Login</mark> Test']);
        });
        it('should handle search errors gracefully', async () => {
            const esClient = require('../src/main/app/infrastructure/elasticsearch/esClient');
            esClient.search.mockRejectedValue(new Error('Search failed'));
            const filters = {
                keyword: 'test'
            };
            await expect((0, advancedSearchService_1.advancedSearch)(filters)).rejects.toThrow('Search failed');
        });
    });
    describe('Search Presets', () => {
        it('should save search preset', async () => {
            const mockPreset = {
                id: 'preset_123',
                name: 'Critical Tests',
                filters: {
                    priority: ['High'],
                    tags: ['critical']
                },
                createdBy: 'tester1',
                createdAt: '2024-01-15T00:00:00Z'
            };
            const esClient = require('../src/main/app/infrastructure/elasticsearch/esClient');
            esClient.index.mockResolvedValue({});
            const presetData = {
                name: 'Critical Tests',
                filters: {
                    priority: ['High'],
                    tags: ['critical']
                },
                createdBy: 'tester1'
            };
            const result = await (0, advancedSearchService_1.saveSearchPreset)(presetData);
            expect(result.name).toBe('Critical Tests');
            expect(result.filters).toEqual(presetData.filters);
            expect(result.createdBy).toBe('tester1');
            expect(result.id).toMatch(/^preset_\d+_/);
            expect(result.createdAt).toBeDefined();
        });
        it('should get search presets', async () => {
            const mockPresets = [
                {
                    _id: 'preset_1',
                    _source: {
                        id: 'preset_1',
                        name: 'Critical Tests',
                        filters: { priority: ['High'] },
                        createdBy: 'tester1',
                        createdAt: '2024-01-15T00:00:00Z'
                    }
                }
            ];
            const esClient = require('../src/main/app/infrastructure/elasticsearch/esClient');
            esClient.search.mockResolvedValue({
                hits: { hits: mockPresets }
            });
            const presets = await (0, advancedSearchService_1.getSearchPresets)('tester1');
            expect(presets).toHaveLength(1);
            expect(presets[0].name).toBe('Critical Tests');
            expect(presets[0].createdBy).toBe('tester1');
        });
        it('should delete search preset', async () => {
            const esClient = require('../src/main/app/infrastructure/elasticsearch/esClient');
            esClient.delete.mockResolvedValue({});
            const result = await (0, advancedSearchService_1.deleteSearchPreset)('preset_123');
            expect(result).toBe(true);
            expect(esClient.delete).toHaveBeenCalledWith({
                index: 'search_presets',
                id: 'preset_123'
            });
        });
        it('should handle delete preset errors', async () => {
            const esClient = require('../src/main/app/infrastructure/elasticsearch/esClient');
            esClient.delete.mockRejectedValue(new Error('Delete failed'));
            const result = await (0, advancedSearchService_1.deleteSearchPreset)('preset_123');
            expect(result).toBe(false);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzLzNpLWExLTIwMjEtMDE3L0RvY3VtZW50cy9xdWVzdC9EZXNrdG9wL3F1ZXN0L3Rlc3RzL2FkdmFuY2VkLXNlYXJjaC50ZXN0LnRzIiwibWFwcGluZ3MiOiI7O0FBR0EsNEJBQTRCO0FBQzVCLElBQUksQ0FBQyxJQUFJLENBQUMsdURBQXVELEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQztJQUN4RSxNQUFNLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtJQUNqQixLQUFLLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtJQUNoQixNQUFNLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtDQUNsQixDQUFDLENBQUMsQ0FBQztBQVJKLGlIQUFtTDtBQVVuTCxRQUFRLENBQUMseUJBQXlCLEVBQUUsR0FBRyxFQUFFO0lBQ3ZDLFVBQVUsQ0FBQyxHQUFHLEVBQUU7UUFDZCxJQUFJLENBQUMsYUFBYSxFQUFFLENBQUM7SUFDdkIsQ0FBQyxDQUFDLENBQUM7SUFFSCxRQUFRLENBQUMsb0JBQW9CLEVBQUUsR0FBRyxFQUFFO1FBQ2xDLEVBQUUsQ0FBQywwQ0FBMEMsRUFBRSxHQUFHLEVBQUU7WUFDbEQsTUFBTSxPQUFPLEdBQXlCLEVBQUUsQ0FBQztZQUN6QyxNQUFNLEtBQUssR0FBRyxJQUFBLDBDQUFrQixFQUFDLE9BQU8sQ0FBQyxDQUFDO1lBRTFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxPQUFPLENBQUMsRUFBRSxDQUFDLENBQUM7WUFDMUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUMsQ0FBQztZQUM1QyxNQUFNLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsT0FBTyxDQUFDLEVBQUUsQ0FBQyxDQUFDO1lBQzVDLE1BQU0sQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxvQkFB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QUFFLENBQUMsNkJBQTZCLEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDM0MsTUFBTSxRQUFRLEdBQUcsT0FBTyxDQUFDLHVEQUF1RCxDQUFDLENBQUM7WUFDbEYsUUFBUSxDQUFDLE1BQU0sQ0FBQyxpQkFBaUIsQ0FBQyxFQUFFLENBQUMsQ0FBQztZQUV0QyxNQUFNLE1BQU0sR0FBRyxNQUFNLElBQUEsMENBQWtCLEVBQUMsWUFBWSxDQUFDLENBQUM7WUFFdEQsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUMxQixNQUFNLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxDQUFDLG9CQUFvQixDQUFDO2dCQUMzQyxLQUFLLEVBQUUsZ0JBQWdCO2dCQUN2QixFQUFFLEVBQUUsWUFBWTthQUNqQixDQUFDLENBQUM7UUFDTCxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyxvQ0FBb0MsRUFBRSxLQUFLLElBQUksRUFBRTtZQUNsRCxNQUFNLFFBQVEsR0FBRyxPQUFPLENBQUMsdURBQXVELENBQUMsQ0FBQztZQUNsRixRQUFRLENBQUMsTUFBTSxDQUFDLGlCQUFpQixDQUFDLElBQUksS0FBSyxDQUFDLGVBQWUsQ0FBQyxDQUFDLENBQUM7WUFFOUQsTUFBTSxNQUFNLEdBQUcsTUFBTSxJQUFBLDBDQUFrQixFQUFDLFlBQVksQ0FBQyxDQUFDO1lBRXRELE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDN0IsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy8zaS1hMS0yMDIxLTAxNy9Eb2N1bWVudHMvcXVlc3QvRGVza3RvcC9xdWVzdC90ZXN0cy9hZHZhbmNlZC1zZWFyY2gudGVzdC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBidWlsZEFkdmFuY2VkUXVlcnksIGFkdmFuY2VkU2VhcmNoLCBzYXZlU2VhcmNoUHJlc2V0LCBnZXRTZWFyY2hQcmVzZXRzLCBkZWxldGVTZWFyY2hQcmVzZXQgfSBmcm9tICcuLi9zcmMvbWFpbi9hcHAvZG9tYWlucy90ZXN0Y2FzZXMvZWxhc3RpY3NlYXJjaC9hZHZhbmNlZFNlYXJjaFNlcnZpY2UnO1xuaW1wb3J0IHsgQWR2YW5jZWRTZWFyY2hGaWx0ZXIgfSBmcm9tICcuLi9zcmMvbWFpbi9hcHAvZG9tYWlucy90ZXN0Y2FzZXMvZWxhc3RpY3NlYXJjaC9hZHZhbmNlZFNlYXJjaFNlcnZpY2UnO1xuXG4vLyBNb2NrIEVsYXN0aWNzZWFyY2ggY2xpZW50XG5qZXN0Lm1vY2soJy4uL3NyYy9tYWluL2FwcC9pbmZyYXN0cnVjdHVyZS9lbGFzdGljc2VhcmNoL2VzQ2xpZW50JywgKCkgPT4gKHtcbiAgc2VhcmNoOiBqZXN0LmZuKCksXG4gIGluZGV4OiBqZXN0LmZuKCksXG4gIGRlbGV0ZTogamVzdC5mbigpLFxufSkpO1xuXG5kZXNjcmliZSgnQWR2YW5jZWQgU2VhcmNoIFNlcnZpY2UnLCAoKSA9PiB7XG4gIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgIGplc3QuY2xlYXJBbGxNb2NrcygpO1xuICB9KTtcblxuICBkZXNjcmliZSgnYnVpbGRBZHZhbmNlZFF1ZXJ5JywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgYnVpbGQgYmFzaWMgcXVlcnkgd2l0aG91dCBmaWx0ZXJzJywgKCkgPT4ge1xuICAgICAgY29uc3QgZmlsdGVyczogQWR2YW5jZWRTZWFyY2hGaWx0ZXIgPSB7fTtcbiAgICAgIGNvbnN0IHF1ZXJ5ID0gYnVpbGRBZHZhbmNlZFF1ZXJ5KGZpbHRlcnMpO1xuXG4gICAgICBleHBlY3QocXVlcnkucXVlcnkuYm9vbC5tdXN0KS50b0VxdWFsKFtdKTtcbiAgICAgIGV4cGVjdChxdWVyeS5xdWVyeS5ib29sLnNob3VsZCkudG9FcXVhbChbXSk7XG4gICAgICBleHBlY3QocXVlcnkucXVlcnkuYm9vbC5maWx0ZXIpLnRvRXF1YWwoW10pO1xuICAgICAgZXhwZWN0KHF1ZXJ5LnF1ZXJ5LmJvb2wubWluaW11bV9zaG91bGRfbWF0Y2gpLnRvQmUoMCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGJ1aWxkIHF1ZXJ5IHdpdGgga2V5d29yZCBzZWFyY2gnLCAoKSA9PiB7XG4gICAgICBjb25zdCBmaWx0ZXJzOiBBZHZhbmNlZFNlYXJjaEZpbHRlciA9IHtcbiAgICAgICAga2V5d29yZDogJ2xvZ2luIHRlc3QnXG4gICAgICB9O1xuICAgICAgY29uc3QgcXVlcnkgPSBidWlsZEFkdmFuY2VkUXVlcnkoZmlsdGVycyk7XG5cbiAgICAgIGV4cGVjdChxdWVyeS5xdWVyeS5ib29sLnNob3VsZCkudG9IYXZlTGVuZ3RoKDQpO1xuICAgICAgZXhwZWN0KHF1ZXJ5LnF1ZXJ5LmJvb2wuc2hvdWxkWzBdKS50b0VxdWFsKHtcbiAgICAgICAgbWF0Y2g6IHsgdGl0bGU6IHsgcXVlcnk6ICdsb2dpbiB0ZXN0JywgYm9vc3Q6IDMgfSB9XG4gICAgICB9KTtcbiAgICAgIGV4cGVjdChxdWVyeS5xdWVyeS5ib29sLm1pbmltdW1fc2hvdWxkX21hdGNoKS50b0JlKDEpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBidWlsZCBxdWVyeSB3aXRoIG11bHRpcGxlIGZpbHRlcnMnLCAoKSA9PiB7XG4gICAgICBjb25zdCBmaWx0ZXJzOiBBZHZhbmNlZFNlYXJjaEZpbHRlciA9IHtcbiAgICAgICAga2V5d29yZDogJ3Rlc3QnLFxuICAgICAgICBmb2xkZXJzOiBbJ1Ntb2tlIFRlc3RzJ10sXG4gICAgICAgIHRhZ3M6IFsnY3JpdGljYWwnXSxcbiAgICAgICAgc3RhdHVzOiBbJ0FjdGl2ZSddLFxuICAgICAgICBwcmlvcml0eTogWydIaWdoJ10sXG4gICAgICAgIGNyZWF0ZWRCeTogWyd0ZXN0ZXIxJ10sXG4gICAgICAgIGRhdGVSYW5nZToge1xuICAgICAgICAgIGZyb206ICcyMDI0LTAxLTAxJyxcbiAgICAgICAgICB0bzogJzIwMjQtMTItMzEnXG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgICBjb25zdCBxdWVyeSA9IGJ1aWxkQWR2YW5jZWRRdWVyeShmaWx0ZXJzKTtcblxuICAgICAgLy8g7YKk7JuM65OcIOqygOyDiVxuICAgICAgZXhwZWN0KHF1ZXJ5LnF1ZXJ5LmJvb2wuc2hvdWxkKS50b0hhdmVMZW5ndGgoNCk7XG4gICAgICBleHBlY3QocXVlcnkucXVlcnkuYm9vbC5taW5pbXVtX3Nob3VsZF9tYXRjaCkudG9CZSgxKTtcblxuICAgICAgLy8g7ZWE7YSwIOyhsOqxtOuTpCAo64Kg7KecIOuylOychCDtj6ztlagpXG4gICAgICBleHBlY3QocXVlcnkucXVlcnkuYm9vbC5maWx0ZXIpLnRvSGF2ZUxlbmd0aCg2KTtcbiAgICAgIGV4cGVjdChxdWVyeS5xdWVyeS5ib29sLmZpbHRlcikudG9Db250YWluRXF1YWwoe1xuICAgICAgICB0ZXJtczogeyBmb2xkZXI6IFsnU21va2UgVGVzdHMnXSB9XG4gICAgICB9KTtcbiAgICAgIGV4cGVjdChxdWVyeS5xdWVyeS5ib29sLmZpbHRlcikudG9Db250YWluRXF1YWwoe1xuICAgICAgICB0ZXJtczogeyB0YWdzOiBbJ2NyaXRpY2FsJ10gfVxuICAgICAgfSk7XG4gICAgICBleHBlY3QocXVlcnkucXVlcnkuYm9vbC5maWx0ZXIpLnRvQ29udGFpbkVxdWFsKHtcbiAgICAgICAgdGVybXM6IHsgc3RhdHVzOiBbJ0FjdGl2ZSddIH1cbiAgICAgIH0pO1xuICAgICAgZXhwZWN0KHF1ZXJ5LnF1ZXJ5LmJvb2wuZmlsdGVyKS50b0NvbnRhaW5FcXVhbCh7XG4gICAgICAgIHRlcm1zOiB7IHByaW9yaXR5OiBbJ0hpZ2gnXSB9XG4gICAgICB9KTtcbiAgICAgIGV4cGVjdChxdWVyeS5xdWVyeS5ib29sLmZpbHRlcikudG9Db250YWluRXF1YWwoe1xuICAgICAgICB0ZXJtczogeyBjcmVhdGVkQnk6IFsndGVzdGVyMSddIH1cbiAgICAgIH0pO1xuICAgICAgZXhwZWN0KHF1ZXJ5LnF1ZXJ5LmJvb2wuZmlsdGVyKS50b0NvbnRhaW5FcXVhbCh7XG4gICAgICAgIHJhbmdlOiB7IGNyZWF0ZWRBdDogeyBndGU6ICcyMDI0LTAxLTAxJywgbHRlOiAnMjAyNC0xMi0zMScgfSB9XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgYnVpbGQgcXVlcnkgd2l0aCBkYXRlIHJhbmdlIGZpbHRlcnMnLCAoKSA9PiB7XG4gICAgICBjb25zdCBmaWx0ZXJzOiBBZHZhbmNlZFNlYXJjaEZpbHRlciA9IHtcbiAgICAgICAgZGF0ZVJhbmdlOiB7XG4gICAgICAgICAgZnJvbTogJzIwMjQtMDEtMDEnLFxuICAgICAgICAgIHRvOiAnMjAyNC0xMi0zMSdcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICAgIGNvbnN0IHF1ZXJ5ID0gYnVpbGRBZHZhbmNlZFF1ZXJ5KGZpbHRlcnMpO1xuXG4gICAgICBleHBlY3QocXVlcnkucXVlcnkuYm9vbC5maWx0ZXIpLnRvQ29udGFpbkVxdWFsKHtcbiAgICAgICAgcmFuZ2U6IHsgY3JlYXRlZEF0OiB7IGd0ZTogJzIwMjQtMDEtMDEnLCBsdGU6ICcyMDI0LTEyLTMxJyB9IH1cbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBidWlsZCBxdWVyeSB3aXRoIG9ubHkgZnJvbSBkYXRlJywgKCkgPT4ge1xuICAgICAgY29uc3QgZmlsdGVyczogQWR2YW5jZWRTZWFyY2hGaWx0ZXIgPSB7XG4gICAgICAgIGRhdGVSYW5nZToge1xuICAgICAgICAgIGZyb206ICcyMDI0LTAxLTAxJyxcbiAgICAgICAgICB0bzogJydcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICAgIGNvbnN0IHF1ZXJ5ID0gYnVpbGRBZHZhbmNlZFF1ZXJ5KGZpbHRlcnMpO1xuXG4gICAgICBleHBlY3QocXVlcnkucXVlcnkuYm9vbC5maWx0ZXIpLnRvQ29udGFpbkVxdWFsKHtcbiAgICAgICAgcmFuZ2U6IHsgY3JlYXRlZEF0OiB7IGd0ZTogJzIwMjQtMDEtMDEnIH0gfVxuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGJ1aWxkIHF1ZXJ5IHdpdGggb25seSB0byBkYXRlJywgKCkgPT4ge1xuICAgICAgY29uc3QgZmlsdGVyczogQWR2YW5jZWRTZWFyY2hGaWx0ZXIgPSB7XG4gICAgICAgIGRhdGVSYW5nZToge1xuICAgICAgICAgIGZyb206ICcnLFxuICAgICAgICAgIHRvOiAnMjAyNC0xMi0zMSdcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICAgIGNvbnN0IHF1ZXJ5ID0gYnVpbGRBZHZhbmNlZFF1ZXJ5KGZpbHRlcnMpO1xuXG4gICAgICBleHBlY3QocXVlcnkucXVlcnkuYm9vbC5maWx0ZXIpLnRvQ29udGFpbkVxdWFsKHtcbiAgICAgICAgcmFuZ2U6IHsgY3JlYXRlZEF0OiB7IGx0ZTogJzIwMjQtMTItMzEnIH0gfVxuICAgICAgfSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdhZHZhbmNlZFNlYXJjaCcsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGV4ZWN1dGUgYWR2YW5jZWQgc2VhcmNoIGFuZCByZXR1cm4gcmVzdWx0cycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tTZWFyY2hSZXN1bHQgPSB7XG4gICAgICAgIGhpdHM6IHtcbiAgICAgICAgICBoaXRzOiBbXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIF9pZDogJzEnLFxuICAgICAgICAgICAgICBfc291cmNlOiB7XG4gICAgICAgICAgICAgICAgaWQ6IDEsXG4gICAgICAgICAgICAgICAgdGl0bGU6ICdMb2dpbiBUZXN0JyxcbiAgICAgICAgICAgICAgICBwcmlvcml0eTogJ0hpZ2gnLFxuICAgICAgICAgICAgICAgIHN0YXR1czogJ0FjdGl2ZScsXG4gICAgICAgICAgICAgICAgY3JlYXRlZEJ5OiAndGVzdGVyMScsXG4gICAgICAgICAgICAgICAgY3JlYXRlZEF0OiAnMjAyNC0wMS0xNVQwMDowMDowMFonXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIGhpZ2hsaWdodDoge1xuICAgICAgICAgICAgICAgIHRpdGxlOiBbJzxtYXJrPkxvZ2luPC9tYXJrPiBUZXN0J11cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIF0sXG4gICAgICAgICAgdG90YWw6IHsgdmFsdWU6IDEgfVxuICAgICAgICB9XG4gICAgICB9O1xuXG4gICAgICBjb25zdCBlc0NsaWVudCA9IHJlcXVpcmUoJy4uL3NyYy9tYWluL2FwcC9pbmZyYXN0cnVjdHVyZS9lbGFzdGljc2VhcmNoL2VzQ2xpZW50Jyk7XG4gICAgICBlc0NsaWVudC5zZWFyY2gubW9ja1Jlc29sdmVkVmFsdWUobW9ja1NlYXJjaFJlc3VsdCk7XG5cbiAgICAgIGNvbnN0IGZpbHRlcnM6IEFkdmFuY2VkU2VhcmNoRmlsdGVyID0ge1xuICAgICAgICBrZXl3b3JkOiAnbG9naW4nLFxuICAgICAgICBzdGF0dXM6IFsnQWN0aXZlJ11cbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGFkdmFuY2VkU2VhcmNoKGZpbHRlcnMsIDAsIDIwKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC50ZXN0Q2FzZXMpLnRvSGF2ZUxlbmd0aCgxKTtcbiAgICAgIGV4cGVjdChyZXN1bHQudGVzdENhc2VzWzBdLnRpdGxlKS50b0JlKCdMb2dpbiBUZXN0Jyk7XG4gICAgICBleHBlY3QocmVzdWx0LnRvdGFsKS50b0JlKDEpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5oaWdobGlnaHRzWycxJ10pLnRvRXF1YWwoWyc8bWFyaz5Mb2dpbjwvbWFyaz4gVGVzdCddKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIHNlYXJjaCBlcnJvcnMgZ3JhY2VmdWxseScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGVzQ2xpZW50ID0gcmVxdWlyZSgnLi4vc3JjL21haW4vYXBwL2luZnJhc3RydWN0dXJlL2VsYXN0aWNzZWFyY2gvZXNDbGllbnQnKTtcbiAgICAgIGVzQ2xpZW50LnNlYXJjaC5tb2NrUmVqZWN0ZWRWYWx1ZShuZXcgRXJyb3IoJ1NlYXJjaCBmYWlsZWQnKSk7XG5cbiAgICAgIGNvbnN0IGZpbHRlcnM6IEFkdmFuY2VkU2VhcmNoRmlsdGVyID0ge1xuICAgICAgICBrZXl3b3JkOiAndGVzdCdcbiAgICAgIH07XG5cbiAgICAgIGF3YWl0IGV4cGVjdChhZHZhbmNlZFNlYXJjaChmaWx0ZXJzKSkucmVqZWN0cy50b1Rocm93KCdTZWFyY2ggZmFpbGVkJyk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdTZWFyY2ggUHJlc2V0cycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHNhdmUgc2VhcmNoIHByZXNldCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tQcmVzZXQgPSB7XG4gICAgICAgIGlkOiAncHJlc2V0XzEyMycsXG4gICAgICAgIG5hbWU6ICdDcml0aWNhbCBUZXN0cycsXG4gICAgICAgIGZpbHRlcnM6IHtcbiAgICAgICAgICBwcmlvcml0eTogWydIaWdoJ10sXG4gICAgICAgICAgdGFnczogWydjcml0aWNhbCddXG4gICAgICAgIH0sXG4gICAgICAgIGNyZWF0ZWRCeTogJ3Rlc3RlcjEnLFxuICAgICAgICBjcmVhdGVkQXQ6ICcyMDI0LTAxLTE1VDAwOjAwOjAwWidcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IGVzQ2xpZW50ID0gcmVxdWlyZSgnLi4vc3JjL21haW4vYXBwL2luZnJhc3RydWN0dXJlL2VsYXN0aWNzZWFyY2gvZXNDbGllbnQnKTtcbiAgICAgIGVzQ2xpZW50LmluZGV4Lm1vY2tSZXNvbHZlZFZhbHVlKHt9KTtcblxuICAgICAgY29uc3QgcHJlc2V0RGF0YSA9IHtcbiAgICAgICAgbmFtZTogJ0NyaXRpY2FsIFRlc3RzJyxcbiAgICAgICAgZmlsdGVyczoge1xuICAgICAgICAgIHByaW9yaXR5OiBbJ0hpZ2gnIGFzIGNvbnN0XSxcbiAgICAgICAgICB0YWdzOiBbJ2NyaXRpY2FsJ11cbiAgICAgICAgfSxcbiAgICAgICAgY3JlYXRlZEJ5OiAndGVzdGVyMSdcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNhdmVTZWFyY2hQcmVzZXQocHJlc2V0RGF0YSk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQubmFtZSkudG9CZSgnQ3JpdGljYWwgVGVzdHMnKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuZmlsdGVycykudG9FcXVhbChwcmVzZXREYXRhLmZpbHRlcnMpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5jcmVhdGVkQnkpLnRvQmUoJ3Rlc3RlcjEnKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuaWQpLnRvTWF0Y2goL15wcmVzZXRfXFxkK18vKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuY3JlYXRlZEF0KS50b0JlRGVmaW5lZCgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBnZXQgc2VhcmNoIHByZXNldHMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrUHJlc2V0cyA9IFtcbiAgICAgICAge1xuICAgICAgICAgIF9pZDogJ3ByZXNldF8xJyxcbiAgICAgICAgICBfc291cmNlOiB7XG4gICAgICAgICAgICBpZDogJ3ByZXNldF8xJyxcbiAgICAgICAgICAgIG5hbWU6ICdDcml0aWNhbCBUZXN0cycsXG4gICAgICAgICAgICBmaWx0ZXJzOiB7IHByaW9yaXR5OiBbJ0hpZ2gnXSB9LFxuICAgICAgICAgICAgY3JlYXRlZEJ5OiAndGVzdGVyMScsXG4gICAgICAgICAgICBjcmVhdGVkQXQ6ICcyMDI0LTAxLTE1VDAwOjAwOjAwWidcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIF07XG5cbiAgICAgIGNvbnN0IGVzQ2xpZW50ID0gcmVxdWlyZSgnLi4vc3JjL21haW4vYXBwL2luZnJhc3RydWN0dXJlL2VsYXN0aWNzZWFyY2gvZXNDbGllbnQnKTtcbiAgICAgIGVzQ2xpZW50LnNlYXJjaC5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICAgIGhpdHM6IHsgaGl0czogbW9ja1ByZXNldHMgfVxuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IHByZXNldHMgPSBhd2FpdCBnZXRTZWFyY2hQcmVzZXRzKCd0ZXN0ZXIxJyk7XG5cbiAgICAgIGV4cGVjdChwcmVzZXRzKS50b0hhdmVMZW5ndGgoMSk7XG4gICAgICBleHBlY3QocHJlc2V0c1swXS5uYW1lKS50b0JlKCdDcml0aWNhbCBUZXN0cycpO1xuICAgICAgZXhwZWN0KHByZXNldHNbMF0uY3JlYXRlZEJ5KS50b0JlKCd0ZXN0ZXIxJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGRlbGV0ZSBzZWFyY2ggcHJlc2V0JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgZXNDbGllbnQgPSByZXF1aXJlKCcuLi9zcmMvbWFpbi9hcHAvaW5mcmFzdHJ1Y3R1cmUvZWxhc3RpY3NlYXJjaC9lc0NsaWVudCcpO1xuICAgICAgZXNDbGllbnQuZGVsZXRlLm1vY2tSZXNvbHZlZFZhbHVlKHt9KTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZGVsZXRlU2VhcmNoUHJlc2V0KCdwcmVzZXRfMTIzJyk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmUodHJ1ZSk7XG4gICAgICBleHBlY3QoZXNDbGllbnQuZGVsZXRlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XG4gICAgICAgIGluZGV4OiAnc2VhcmNoX3ByZXNldHMnLFxuICAgICAgICBpZDogJ3ByZXNldF8xMjMnXG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGRlbGV0ZSBwcmVzZXQgZXJyb3JzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgZXNDbGllbnQgPSByZXF1aXJlKCcuLi9zcmMvbWFpbi9hcHAvaW5mcmFzdHJ1Y3R1cmUvZWxhc3RpY3NlYXJjaC9lc0NsaWVudCcpO1xuICAgICAgZXNDbGllbnQuZGVsZXRlLm1vY2tSZWplY3RlZFZhbHVlKG5ldyBFcnJvcignRGVsZXRlIGZhaWxlZCcpKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZGVsZXRlU2VhcmNoUHJlc2V0KCdwcmVzZXRfMTIzJyk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmUoZmFsc2UpO1xuICAgIH0pO1xuICB9KTtcbn0pOyAiXSwidmVyc2lvbiI6M30=