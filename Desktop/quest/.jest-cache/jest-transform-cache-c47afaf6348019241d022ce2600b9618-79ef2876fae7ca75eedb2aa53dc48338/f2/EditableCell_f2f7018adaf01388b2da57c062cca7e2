f8bca11680c8b0a16ed38b30be9745e9
"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const jsx_runtime_1 = require("react/jsx-runtime");
const react_1 = require("react");
const styled_components_1 = __importDefault(require("styled-components"));
const CellContainer = styled_components_1.default.div `
  position: relative;
  width: 100%;
  height: 100%;
`;
const DisplayValue = styled_components_1.default.div `
  padding: 8px 12px;
  border: 2px solid transparent;
  border-radius: 4px;
  cursor: pointer;
  transition: all 0.2s ease;
  
  &:hover {
    border-color: #e2e8f0;
    background-color: #f8fafc;
  }
  
  &.editing {
    border-color: #3b82f6;
    background-color: #eff6ff;
  }
`;
const Input = styled_components_1.default.input `
  width: 100%;
  padding: 8px 12px;
  border: 2px solid #3b82f6;
  border-radius: 4px;
  font-size: inherit;
  font-family: inherit;
  outline: none;
  background-color: white;
  
  &:focus {
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
  }
`;
const Select = styled_components_1.default.select `
  width: 100%;
  padding: 8px 12px;
  border: 2px solid #3b82f6;
  border-radius: 4px;
  font-size: inherit;
  font-family: inherit;
  outline: none;
  background-color: white;
  cursor: pointer;
  
  &:focus {
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
  }
`;
const Checkbox = styled_components_1.default.input `
  width: 18px;
  height: 18px;
  cursor: pointer;
  accent-color: #3b82f6;
`;
const SaveIndicator = styled_components_1.default.div `
  position: absolute;
  top: -20px;
  right: 0;
  background-color: #10b981;
  color: white;
  padding: 2px 6px;
  border-radius: 4px;
  font-size: 12px;
  opacity: 0;
  transition: opacity 0.3s ease;
  
  &.saving {
    opacity: 1;
  }
`;
const EditableCell = ({ value, type = 'text', options = [], onSave, onCancel, placeholder = '', disabled = false, className = '' }) => {
    const [isEditing, setIsEditing] = (0, react_1.useState)(false);
    const [editValue, setEditValue] = (0, react_1.useState)(value);
    const [isSaving, setIsSaving] = (0, react_1.useState)(false);
    const inputRef = (0, react_1.useRef)(null);
    const selectRef = (0, react_1.useRef)(null);
    const saveTimeoutRef = (0, react_1.useRef)(undefined);
    // 편집 모드 진입
    const startEditing = (0, react_1.useCallback)(() => {
        if (disabled)
            return;
        setIsEditing(true);
        setEditValue(value);
    }, [disabled, value]);
    // 편집 모드 종료
    const stopEditing = (0, react_1.useCallback)(() => {
        setIsEditing(false);
        setIsSaving(false);
        if (saveTimeoutRef.current) {
            clearTimeout(saveTimeoutRef.current);
        }
    }, []);
    // 저장 실행
    const saveValue = (0, react_1.useCallback)(() => {
        if (editValue !== value) {
            setIsSaving(true);
            onSave(editValue);
            // 저장 완료 표시 후 숨김
            setTimeout(() => {
                setIsSaving(false);
            }, 1000);
        }
        stopEditing();
    }, [editValue, value, onSave, stopEditing]);
    // 취소
    const cancelEdit = (0, react_1.useCallback)(() => {
        setEditValue(value);
        stopEditing();
        onCancel?.();
    }, [value, stopEditing, onCancel]);
    // 자동저장 (debounce)
    const debouncedSave = (0, react_1.useCallback)(() => {
        if (saveTimeoutRef.current) {
            clearTimeout(saveTimeoutRef.current);
        }
        saveTimeoutRef.current = setTimeout(() => {
            if (editValue !== value) {
                setIsSaving(true);
                onSave(editValue);
                setTimeout(() => setIsSaving(false), 1000);
            }
        }, 500);
    }, [editValue, value, onSave]);
    // 키보드 이벤트 처리
    const handleKeyDown = (0, react_1.useCallback)((e) => {
        if (e.key === 'Enter') {
            e.preventDefault();
            saveValue();
        }
        else if (e.key === 'Escape') {
            e.preventDefault();
            cancelEdit();
        }
    }, [saveValue, cancelEdit]);
    // 값 변경 시 자동저장
    (0, react_1.useEffect)(() => {
        if (isEditing && editValue !== value) {
            debouncedSave();
        }
    }, [editValue, isEditing, value, debouncedSave]);
    // 포커스 관리
    (0, react_1.useEffect)(() => {
        if (isEditing) {
            if (type === 'select' && selectRef.current) {
                selectRef.current.focus();
            }
            else if (inputRef.current) {
                inputRef.current.focus();
                inputRef.current.select();
            }
        }
    }, [isEditing, type]);
    // 값 변경 시 편집값 동기화
    (0, react_1.useEffect)(() => {
        if (!isEditing) {
            setEditValue(value);
        }
    }, [value, isEditing]);
    // 렌더링 함수들
    const renderDisplayValue = () => {
        if (type === 'checkbox') {
            return ((0, jsx_runtime_1.jsx)(Checkbox, { type: "checkbox", checked: Boolean(value), onChange: (e) => onSave(e.target.checked), disabled: disabled }));
        }
        if (type === 'select') {
            const option = options.find(opt => opt.value === String(value));
            return option?.label || String(value);
        }
        return String(value);
    };
    const renderEditInput = () => {
        if (type === 'select') {
            return ((0, jsx_runtime_1.jsx)(Select, { ref: selectRef, value: String(editValue), onChange: (e) => setEditValue(e.target.value), onKeyDown: handleKeyDown, onBlur: saveValue, children: options.map(option => ((0, jsx_runtime_1.jsx)("option", { value: option.value, children: option.label }, option.value))) }));
        }
        if (type === 'checkbox') {
            return ((0, jsx_runtime_1.jsx)(Checkbox, { type: "checkbox", checked: Boolean(editValue), onChange: (e) => setEditValue(e.target.checked), onKeyDown: handleKeyDown, onBlur: saveValue }));
        }
        return ((0, jsx_runtime_1.jsx)(Input, { ref: inputRef, type: "text", value: String(editValue), onChange: (e) => setEditValue(e.target.value), onKeyDown: handleKeyDown, onBlur: saveValue, placeholder: placeholder }));
    };
    return ((0, jsx_runtime_1.jsxs)(CellContainer, { className: className, children: [isEditing ? (renderEditInput()) : ((0, jsx_runtime_1.jsx)(DisplayValue, { onClick: startEditing, className: isEditing ? 'editing' : '', children: renderDisplayValue() })), (0, jsx_runtime_1.jsx)(SaveIndicator, { className: isSaving ? 'saving' : '', children: "\uC800\uC7A5\uB428" })] }));
};
exports.default = EditableCell;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzLzNpLWExLTIwMjEtMDE3L0RvY3VtZW50cy9xdWVzdC9EZXNrdG9wL3F1ZXN0L3NyYy9yZW5kZXJlci9zaGFyZWQvY29tcG9uZW50cy9FZGl0YWJsZUNlbGwudHN4IiwibWFwcGluZ3MiOiI7Ozs7OztBQUFBLGlDQUF3RTtBQUN4RSwwRUFBdUM7QUFhdkMsTUFBTSxhQUFhLEdBQUcsMkJBQU0sQ0FBQyxHQUFHLENBQUE7Ozs7Q0FJL0IsQ0FBQztBQUVGLE1BQU0sWUFBWSxHQUFHLDJCQUFNLENBQUMsR0FBRyxDQUFBOzs7Ozs7Ozs7Ozs7Ozs7O0NBZ0I5QixDQUFDO0FBRUYsTUFBTSxLQUFLLEdBQUcsMkJBQU0sQ0FBQyxLQUFLLENBQUE7Ozs7Ozs7Ozs7Ozs7Q0FhekIsQ0FBQztBQUVGLE1BQU0sTUFBTSxHQUFHLDJCQUFNLENBQUMsTUFBTSxDQUFBOzs7Ozs7Ozs7Ozs7OztDQWMzQixDQUFDO0FBRUYsTUFBTSxRQUFRLEdBQUcsMkJBQU0sQ0FBQyxLQUFLLENBQUE7Ozs7O0NBSzVCLENBQUM7QUFFRixNQUFNLGFBQWEsR0FBRywyQkFBTSxDQUFDLEdBQUcsQ0FBQTs7Ozs7Ozs7Ozs7Ozs7O0NBZS9CLENBQUM7QUFFRixNQUFNLFlBQVksR0FBZ0MsQ0FBQyxFQUNqRCxLQUFLLEVBQ0wsSUFBSSxHQUFHLE1BQU0sRUFDYixPQUFPLEdBQUcsRUFBRSxFQUNaLE1BQU0sRUFDTixRQUFRLEVBQ1IsV0FBVyxHQUFHLEVBQUUsRUFDaEIsUUFBUSxHQUFHLEtBQUssRUFDaEIsU0FBUyxHQUFHLEVBQUUsRUFDZixFQUFFLEVBQUU7SUFDSCxNQUFNLENBQUMsU0FBUyxFQUFFLFlBQVksQ0FBQyxHQUFHLElBQUEsZ0JBQVEsRUFBQyxLQUFLLENBQUMsQ0FBQztJQUNsRCxNQUFNLENBQUMsU0FBUyxFQUFFLFlBQVksQ0FBQyxHQUFHLElBQUEsZ0JBQVEsRUFBQyxLQUFLLENBQUMsQ0FBQztJQUNsRCxNQUFNLENBQUMsUUFBUSxFQUFFLFdBQVcsQ0FBQyxHQUFHLElBQUEsZ0JBQVEsRUFB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QUMsQ0FBQyxDQUFDLEVBQUUsbUNBRWxDLElBQ0YsQ0FDakIsQ0FBQztBQUNKLENBQUMsQ0FBQztBQUVGLGtCQUFlLFlBQVksQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVXNlcnMvM2ktYTEtMjAyMS0wMTcvRG9jdW1lbnRzL3F1ZXN0L0Rlc2t0b3AvcXVlc3Qvc3JjL3JlbmRlcmVyL3NoYXJlZC9jb21wb25lbnRzL0VkaXRhYmxlQ2VsbC50c3giXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlYWN0LCB7IHVzZVN0YXRlLCB1c2VFZmZlY3QsIHVzZVJlZiwgdXNlQ2FsbGJhY2sgfSBmcm9tICdyZWFjdCc7XG5pbXBvcnQgc3R5bGVkIGZyb20gJ3N0eWxlZC1jb21wb25lbnRzJztcblxuaW50ZXJmYWNlIEVkaXRhYmxlQ2VsbFByb3BzIHtcbiAgdmFsdWU6IHN0cmluZyB8IG51bWJlciB8IGJvb2xlYW47XG4gIHR5cGU/OiAndGV4dCcgfCAnc2VsZWN0JyB8ICdjaGVja2JveCc7XG4gIG9wdGlvbnM/OiB7IHZhbHVlOiBzdHJpbmc7IGxhYmVsOiBzdHJpbmcgfVtdO1xuICBvblNhdmU6ICh2YWx1ZTogc3RyaW5nIHwgbnVtYmVyIHwgYm9vbGVhbikgPT4gdm9pZDtcbiAgb25DYW5jZWw/OiAoKSA9PiB2b2lkO1xuICBwbGFjZWhvbGRlcj86IHN0cmluZztcbiAgZGlzYWJsZWQ/OiBib29sZWFuO1xuICBjbGFzc05hbWU/OiBzdHJpbmc7XG59XG5cbmNvbnN0IENlbGxDb250YWluZXIgPSBzdHlsZWQuZGl2YFxuICBwb3NpdGlvbjogcmVsYXRpdmU7XG4gIHdpZHRoOiAxMDAlO1xuICBoZWlnaHQ6IDEwMCU7XG5gO1xuXG5jb25zdCBEaXNwbGF5VmFsdWUgPSBzdHlsZWQuZGl2YFxuICBwYWRkaW5nOiA4cHggMTJweDtcbiAgYm9yZGVyOiAycHggc29saWQgdHJhbnNwYXJlbnQ7XG4gIGJvcmRlci1yYWRpdXM6IDRweDtcbiAgY3Vyc29yOiBwb2ludGVyO1xuICB0cmFuc2l0aW9uOiBhbGwgMC4ycyBlYXNlO1xuICBcbiAgJjpob3ZlciB7XG4gICAgYm9yZGVyLWNvbG9yOiAjZTJlOGYwO1xuICAgIGJhY2tncm91bmQtY29sb3I6ICNmOGZhZmM7XG4gIH1cbiAgXG4gICYuZWRpdGluZyB7XG4gICAgYm9yZGVyLWNvbG9yOiAjM2I4MmY2O1xuICAgIGJhY2tncm91bmQtY29sb3I6ICNlZmY2ZmY7XG4gIH1cbmA7XG5cbmNvbnN0IElucHV0ID0gc3R5bGVkLmlucHV0YFxuICB3aWR0aDogMTAwJTtcbiAgcGFkZGluZzogOHB4IDEycHg7XG4gIGJvcmRlcjogMnB4IHNvbGlkICMzYjgyZjY7XG4gIGJvcmRlci1yYWRpdXM6IDRweDtcbiAgZm9udC1zaXplOiBpbmhlcml0O1xuICBmb250LWZhbWlseTogaW5oZXJpdDtcbiAgb3V0bGluZTogbm9uZTtcbiAgYmFja2dyb3VuZC1jb2xvcjogd2hpdGU7XG4gIFxuICAmOmZvY3VzIHtcbiAgICBib3gtc2hhZG93OiAwIDAgMCAzcHggcmdiYSg1OSwgMTMwLCAyNDYsIDAuMSk7XG4gIH1cbmA7XG5cbmNvbnN0IFNlbGVjdCA9IHN0eWxlZC5zZWxlY3RgXG4gIHdpZHRoOiAxMDAlO1xuICBwYWRkaW5nOiA4cHggMTJweDtcbiAgYm9yZGVyOiAycHggc29saWQgIzNiODJmNjtcbiAgYm9yZGVyLXJhZGl1czogNHB4O1xuICBmb250LXNpemU6IGluaGVyaXQ7XG4gIGZvbnQtZmFtaWx5OiBpbmhlcml0O1xuICBvdXRsaW5lOiBub25lO1xuICBiYWNrZ3JvdW5kLWNvbG9yOiB3aGl0ZTtcbiAgY3Vyc29yOiBwb2ludGVyO1xuICBcbiAgJjpmb2N1cyB7XG4gICAgYm94LXNoYWRvdzogMCAwIDAgM3B4IHJnYmEoNTksIDEzMCwgMjQ2LCAwLjEpO1xuICB9XG5gO1xuXG5jb25zdCBDaGVja2JveCA9IHN0eWxlZC5pbnB1dGBcbiAgd2lkdGg6IDE4cHg7XG4gIGhlaWdodDogMThweDtcbiAgY3Vyc29yOiBwb2ludGVyO1xuICBhY2NlbnQtY29sb3I6ICMzYjgyZjY7XG5gO1xuXG5jb25zdCBTYXZlSW5kaWNhdG9yID0gc3R5bGVkLmRpdmBcbiAgcG9zaXRpb246IGFic29sdXRlO1xuICB0b3A6IC0yMHB4O1xuICByaWdodDogMDtcbiAgYmFja2dyb3VuZC1jb2xvcjogIzEwYjk4MTtcbiAgY29sb3I6IHdoaXRlO1xuICBwYWRkaW5nOiAycHggNnB4O1xuICBib3JkZXItcmFkaXVzOiA0cHg7XG4gIGZvbnQtc2l6ZTogMTJweDtcbiAgb3BhY2l0eTogMDtcbiAgdHJhbnNpdGlvbjogb3BhY2l0eSAwLjNzIGVhc2U7XG4gIFxuICAmLnNhdmluZyB7XG4gICAgb3BhY2l0eTogMTtcbiAgfVxuYDtcblxuY29uc3QgRWRpdGFibGVDZWxsOiBSZWFjdC5GQzxFZGl0YWJsZUNlbGxQcm9wcz4gPSAoe1xuICB2YWx1ZSxcbiAgdHlwZSA9ICd0ZXh0JyxcbiAgb3B0aW9ucyA9IFtdLFxuICBvblNhdmUsXG4gIG9uQ2FuY2VsLFxuICBwbGFjZWhvbGRlciA9ICcnLFxuICBkaXNhYmxlZCA9IGZhbHNlLFxuICBjbGFzc05hbWUgPSAnJ1xufSkgPT4ge1xuICBjb25zdCBbaXNFZGl0aW5nLCBzZXRJc0VkaXRpbmddID0gdXNlU3RhdGUoZmFsc2UpO1xuICBjb25zdCBbZWRpdFZhbHVlLCBzZXRFZGl0VmFsdWVdID0gdXNlU3RhdGUodmFsdWUpO1xuICBjb25zdCBbaXNTYXZpbmcsIHNldElzU2F2aW5nXSA9IHVzZVN0YXRlKGZhbHNlKTtcbiAgY29uc3QgaW5wdXRSZWYgPSB1c2VSZWY8SFRNTElucHV0RWxlbWVudD4obnVsbCk7XG4gIGNvbnN0IHNlbGVjdFJlZiA9IHVzZVJlZjxIVE1MU2VsZWN0RWxlbWVudD4obnVsbCk7XG4gIGNvbnN0IHNhdmVUaW1lb3V0UmVmID0gdXNlUmVmPE5vZGVKUy5UaW1lb3V0IHwgdW5kZWZpbmVkPih1bmRlZmluZWQpO1xuXG4gIC8vIO2OuOynkSDrqqjrk5wg7KeE7J6FXG4gIGNvbnN0IHN0YXJ0RWRpdGluZyA9IHVzZUNhbGxiYWNrKCgpID0+IHtcbiAgICBpZiAoZGlzYWJsZWQpIHJldHVybjtcbiAgICBzZXRJc0VkaXRpbmcodHJ1ZSk7XG4gICAgc2V0RWRpdFZhbHVlKHZhbHVlKTtcbiAgfSwgW2Rpc2FibGVkLCB2YWx1ZV0pO1xuXG4gIC8vIO2OuOynkSDrqqjrk5wg7KKF66OMXG4gIGNvbnN0IHN0b3BFZGl0aW5nID0gdXNlQ2FsbGJhY2soKCkgPT4ge1xuICAgIHNldElzRWRpdGluZyhmYWxzZSk7XG4gICAgc2V0SXNTYXZpbmcoZmFsc2UpO1xuICAgIGlmIChzYXZlVGltZW91dFJlZi5jdXJyZW50KSB7XG4gICAgICBjbGVhclRpbWVvdXQoc2F2ZVRpbWVvdXRSZWYuY3VycmVudCk7XG4gICAgfVxuICB9LCBbXSk7XG5cbiAgLy8g7KCA7J6lIOyLpO2WiVxuICBjb25zdCBzYXZlVmFsdWUgPSB1c2VDYWxsYmFjaygoKSA9PiB7XG4gICAgaWYgKGVkaXRWYWx1ZSAhPT0gdmFsdWUpIHtcbiAgICAgIHNldElzU2F2aW5nKHRydWUpO1xuICAgICAgb25TYXZlKGVkaXRWYWx1ZSk7XG4gICAgICBcbiAgICAgIC8vIOyggOyepSDsmYTro4wg7ZGc7IucIO2bhCDsiKjquYBcbiAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICBzZXRJc1NhdmluZyhmYWxzZSk7XG4gICAgICB9LCAxMDAwKTtcbiAgICB9XG4gICAgc3RvcEVkaXRpbmcoKTtcbiAgfSwgW2VkaXRWYWx1ZSwgdmFsdWUsIG9uU2F2ZSwgc3RvcEVkaXRpbmddKTtcblxuICAvLyDst6jshoxcbiAgY29uc3QgY2FuY2VsRWRpdCA9IHVzZUNhbGxiYWNrKCgpID0+IHtcbiAgICBzZXRFZGl0VmFsdWUodmFsdWUpO1xuICAgIHN0b3BFZGl0aW5nKCk7XG4gICAgb25DYW5jZWw/LigpO1xuICB9LCBbdmFsdWUsIHN0b3BFZGl0aW5nLCBvbkNhbmNlbF0pO1xuXG4gIC8vIOyekOuPmeyggOyepSAoZGVib3VuY2UpXG4gIGNvbnN0IGRlYm91bmNlZFNhdmUgPSB1c2VDYWxsYmFjaygoKSA9PiB7XG4gICAgaWYgKHNhdmVUaW1lb3V0UmVmLmN1cnJlbnQpIHtcbiAgICAgIGNsZWFyVGltZW91dChzYXZlVGltZW91dFJlZi5jdXJyZW50KTtcbiAgICB9XG4gICAgXG4gICAgc2F2ZVRpbWVvdXRSZWYuY3VycmVudCA9IHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgaWYgKGVkaXRWYWx1ZSAhPT0gdmFsdWUpIHtcbiAgICAgICAgc2V0SXNTYXZpbmcodHJ1ZSk7XG4gICAgICAgIG9uU2F2ZShlZGl0VmFsdWUpO1xuICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHNldElzU2F2aW5nKGZhbHNlKSwgMTAwMCk7XG4gICAgICB9XG4gICAgfSwgNTAwKTtcbiAgfSwgW2VkaXRWYWx1ZSwgdmFsdWUsIG9uU2F2ZV0pO1xuXG4gIC8vIO2CpOuztOuTnCDsnbTrsqTtirgg7LKY66asXG4gIGNvbnN0IGhhbmRsZUtleURvd24gPSB1c2VDYWxsYmFjaygoZTogUmVhY3QuS2V5Ym9hcmRFdmVudCkgPT4ge1xuICAgIGlmIChlLmtleSA9PT0gJ0VudGVyJykge1xuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgc2F2ZVZhbHVlKCk7XG4gICAgfSBlbHNlIGlmIChlLmtleSA9PT0gJ0VzY2FwZScpIHtcbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgIGNhbmNlbEVkaXQoKTtcbiAgICB9XG4gIH0sIFtzYXZlVmFsdWUsIGNhbmNlbEVkaXRdKTtcblxuICAvLyDqsJIg67OA6rK9IOyLnCDsnpDrj5nsoIDsnqVcbiAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICBpZiAoaXNFZGl0aW5nICYmIGVkaXRWYWx1ZSAhPT0gdmFsdWUpIHtcbiAgICAgIGRlYm91bmNlZFNhdmUoKTtcbiAgICB9XG4gIH0sIFtlZGl0VmFsdWUsIGlzRWRpdGluZywgdmFsdWUsIGRlYm91bmNlZFNhdmVdKTtcblxuICAvLyDtj6zsu6TsiqQg6rSA66asXG4gIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgaWYgKGlzRWRpdGluZykge1xuICAgICAgaWYgKHR5cGUgPT09ICdzZWxlY3QnICYmIHNlbGVjdFJlZi5jdXJyZW50KSB7XG4gICAgICAgIHNlbGVjdFJlZi5jdXJyZW50LmZvY3VzKCk7XG4gICAgICB9IGVsc2UgaWYgKGlucHV0UmVmLmN1cnJlbnQpIHtcbiAgICAgICAgaW5wdXRSZWYuY3VycmVudC5mb2N1cygpO1xuICAgICAgICBpbnB1dFJlZi5jdXJyZW50LnNlbGVjdCgpO1xuICAgICAgfVxuICAgIH1cbiAgfSwgW2lzRWRpdGluZywgdHlwZV0pO1xuXG4gIC8vIOqwkiDrs4Dqsr0g7IucIO2OuOynkeqwkiDrj5nquLDtmZRcbiAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICBpZiAoIWlzRWRpdGluZykge1xuICAgICAgc2V0RWRpdFZhbHVlKHZhbHVlKTtcbiAgICB9XG4gIH0sIFt2YWx1ZSwgaXNFZGl0aW5nXSk7XG5cbiAgLy8g66CM642U66eBIO2VqOyImOuTpFxuICBjb25zdCByZW5kZXJEaXNwbGF5VmFsdWUgPSAoKSA9PiB7XG4gICAgaWYgKHR5cGUgPT09ICdjaGVja2JveCcpIHtcbiAgICAgIHJldHVybiAoXG4gICAgICAgIDxDaGVja2JveFxuICAgICAgICAgIHR5cGU9XCJjaGVja2JveFwiXG4gICAgICAgICAgY2hlY2tlZD17Qm9vbGVhbih2YWx1ZSl9XG4gICAgICAgICAgb25DaGFuZ2U9eyhlKSA9PiBvblNhdmUoZS50YXJnZXQuY2hlY2tlZCl9XG4gICAgICAgICAgZGlzYWJsZWQ9e2Rpc2FibGVkfVxuICAgICAgICAvPlxuICAgICAgKTtcbiAgICB9XG4gICAgXG4gICAgaWYgKHR5cGUgPT09ICdzZWxlY3QnKSB7XG4gICAgICBjb25zdCBvcHRpb24gPSBvcHRpb25zLmZpbmQob3B0ID0+IG9wdC52YWx1ZSA9PT0gU3RyaW5nKHZhbHVlKSk7XG4gICAgICByZXR1cm4gb3B0aW9uPy5sYWJlbCB8fCBTdHJpbmcodmFsdWUpO1xuICAgIH1cbiAgICBcbiAgICByZXR1cm4gU3RyaW5nKHZhbHVlKTtcbiAgfTtcblxuICBjb25zdCByZW5kZXJFZGl0SW5wdXQgPSAoKSA9PiB7XG4gICAgaWYgKHR5cGUgPT09ICdzZWxlY3QnKSB7XG4gICAgICByZXR1cm4gKFxuICAgICAgICA8U2VsZWN0XG4gICAgICAgICAgcmVmPXtzZWxlY3RSZWZ9XG4gICAgICAgICAgdmFsdWU9e1N0cmluZyhlZGl0VmFsdWUpfVxuICAgICAgICAgIG9uQ2hhbmdlPXsoZSkgPT4gc2V0RWRpdFZhbHVlKGUudGFyZ2V0LnZhbHVlKX1cbiAgICAgICAgICBvbktleURvd249e2hhbmRsZUtleURvd259XG4gICAgICAgICAgb25CbHVyPXtzYXZlVmFsdWV9XG4gICAgICAgID5cbiAgICAgICAgICB7b3B0aW9ucy5tYXAob3B0aW9uID0+IChcbiAgICAgICAgICAgIDxvcHRpb24ga2V5PXtvcHRpb24udmFsdWV9IHZhbHVlPXtvcHRpb24udmFsdWV9PlxuICAgICAgICAgICAgICB7b3B0aW9uLmxhYmVsfVxuICAgICAgICAgICAgPC9vcHRpb24+XG4gICAgICAgICAgKSl9XG4gICAgICAgIDwvU2VsZWN0PlxuICAgICAgKTtcbiAgICB9XG4gICAgXG4gICAgaWYgKHR5cGUgPT09ICdjaGVja2JveCcpIHtcbiAgICAgIHJldHVybiAoXG4gICAgICAgIDxDaGVja2JveFxuICAgICAgICAgIHR5cGU9XCJjaGVja2JveFwiXG4gICAgICAgICAgY2hlY2tlZD17Qm9vbGVhbihlZGl0VmFsdWUpfVxuICAgICAgICAgIG9uQ2hhbmdlPXsoZSkgPT4gc2V0RWRpdFZhbHVlKGUudGFyZ2V0LmNoZWNrZWQpfVxuICAgICAgICAgIG9uS2V5RG93bj17aGFuZGxlS2V5RG93bn1cbiAgICAgICAgICBvbkJsdXI9e3NhdmVWYWx1ZX1cbiAgICAgICAgLz5cbiAgICAgICk7XG4gICAgfVxuICAgIFxuICAgIHJldHVybiAoXG4gICAgICA8SW5wdXRcbiAgICAgICAgcmVmPXtpbnB1dFJlZn1cbiAgICAgICAgdHlwZT1cInRleHRcIlxuICAgICAgICB2YWx1ZT17U3RyaW5nKGVkaXRWYWx1ZSl9XG4gICAgICAgIG9uQ2hhbmdlPXsoZSkgPT4gc2V0RWRpdFZhbHVlKGUudGFyZ2V0LnZhbHVlKX1cbiAgICAgICAgb25LZXlEb3duPXtoYW5kbGVLZXlEb3dufVxuICAgICAgICBvbkJsdXI9e3NhdmVWYWx1ZX1cbiAgICAgICAgcGxhY2Vob2xkZXI9e3BsYWNlaG9sZGVyfVxuICAgICAgLz5cbiAgICApO1xuICB9O1xuXG4gIHJldHVybiAoXG4gICAgPENlbGxDb250YWluZXIgY2xhc3NOYW1lPXtjbGFzc05hbWV9PlxuICAgICAge2lzRWRpdGluZyA/IChcbiAgICAgICAgcmVuZGVyRWRpdElucHV0KClcbiAgICAgICkgOiAoXG4gICAgICAgIDxEaXNwbGF5VmFsdWVcbiAgICAgICAgICBvbkNsaWNrPXtzdGFydEVkaXRpbmd9XG4gICAgICAgICAgY2xhc3NOYW1lPXtpc0VkaXRpbmcgPyAnZWRpdGluZycgOiAnJ31cbiAgICAgICAgPlxuICAgICAgICAgIHtyZW5kZXJEaXNwbGF5VmFsdWUoKX1cbiAgICAgICAgPC9EaXNwbGF5VmFsdWU+XG4gICAgICApfVxuICAgICAgXG4gICAgICA8U2F2ZUluZGljYXRvciBjbGFzc05hbWU9e2lzU2F2aW5nID8gJ3NhdmluZycgOiAnJ30+XG4gICAgICAgIOyggOyepeuQqFxuICAgICAgPC9TYXZlSW5kaWNhdG9yPlxuICAgIDwvQ2VsbENvbnRhaW5lcj5cbiAgKTtcbn07XG5cbmV4cG9ydCBkZWZhdWx0IEVkaXRhYmxlQ2VsbDsgIl0sInZlcnNpb24iOjN9