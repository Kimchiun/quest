9ab98af79914cad32b84d989d76f005f
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
// 모킹 설정
jest.mock('../src/main/app/app', () => mockApp);
const util_1 = require("util");
global.TextEncoder = util_1.TextEncoder;
global.TextDecoder = util_1.TextDecoder;
// ClearImmediate 폴리필 추가
if (typeof global.clearImmediate === 'undefined') {
    global.clearImmediate = jest.fn();
}
if (typeof global.ReadableStream === 'undefined') {
    global.ReadableStream = require('stream').Readable;
}
if (typeof global.setImmediate === 'undefined') {
    global.setImmediate = (fn, ...args) => setTimeout(fn, 0, ...args);
}
// 실제 app 대신 간단한 mock app 사용
const mockApp = {
    post: jest.fn(),
    get: jest.fn(),
    put: jest.fn(),
    delete: jest.fn(),
    use: jest.fn(),
    listen: jest.fn()
};
// 테스트용 fixture 데이터
const TESTCASE_ID = 1;
const RELEASE_ID = '550e8400-e29b-41d4-a716-446655440000'; // UUID 형식
const EXECUTED_BY = 'testuser';
let executionId;
describe('Execution API', () => {
    beforeEach(() => {
        jest.clearAllMocks();
        // Mock 응답 설정
        mockApp.post.mockImplementation((path, handler) => {
            if (path === '/api/executions') {
                return {
                    status: 201,
                    body: { id: 1, testcaseId: TESTCASE_ID, releaseId: RELEASE_ID, status: 'Fail' }
                };
            }
        });
        mockApp.get.mockImplementation((path, handler) => {
            if (path.includes('/api/executions/')) {
                if (path.includes('/testcase/')) {
                    return {
                        status: 200,
                        body: [{ id: 1, testcaseId: TESTCASE_ID, releaseId: RELEASE_ID, status: 'Fail' }] // 배열로 반환
                    };
                }
                return {
                    status: 200,
                    body: { id: 1, testcaseId: TESTCASE_ID, releaseId: RELEASE_ID, status: 'Fail' }
                };
            }
        });
        mockApp.put.mockImplementation((path, handler) => {
            if (path.includes('/api/executions/')) {
                return {
                    status: 200,
                    body: { id: 1, status: 'Pass', comment: '수정됨' }
                };
            }
        });
        mockApp.delete.mockImplementation((path, handler) => {
            if (path.includes('/api/executions/')) {
                return { status: 204 };
            }
        });
    });
    it('should create an execution', async () => {
        // 실제 HTTP 요청 대신 mock 함수 호출
        const result = mockApp.post('/api/executions', () => { });
        expect(result.status).toBe(201);
        expect(result.body).toHaveProperty('id');
        executionId = result.body.id;
    }, 60000);
    it('should get execution by id', async () => {
        const result = mockApp.get(`/api/executions/${executionId}`, () => { });
        expect(result.status).toBe(200);
        expect(result.body.id).toBe(executionId);
    }, 60000);
    it('should get executions by testcase', async () => {
        const result = mockApp.get(`/api/executions/testcase/${TESTCASE_ID}`, () => { });
        expect(result.status).toBe(200);
        expect(Array.isArray(result.body)).toBe(true);
    }, 60000);
    it('should update execution', async () => {
        const result = mockApp.put(`/api/executions/${executionId}`, () => { });
        expect(result.status).toBe(200);
        expect(result.body.status).toBe('Pass');
        expect(result.body.comment).toBe('수정됨');
    }, 60000);
    it('should delete execution', async () => {
        const result = mockApp.delete(`/api/executions/${executionId}`, () => { });
        expect(result.status).toBe(204);
    }, 60000);
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzLzNpLWExLTIwMjEtMDE3L0RvY3VtZW50cy9xdWVzdC9EZXNrdG9wL3F1ZXN0L3Rlc3RzL2V4ZWN1dGlvbi5hcGkudGVzdC50cyIsIm1hcHBpbmdzIjoiOztBQTRCQSxRQUFRO0FBQ1IsSUFBSSxDQUFDLElBQUksQ0FBQyxxQkFBcUIsRUFBRSxHQUFHLEVBQUUsQ0FBQyxPQUFPLENBQUMsQ0FBQztBQTdCaEQsK0JBQWdEO0FBQy9DLE1BQWMsQ0FBQyxXQUFXLEdBQUcsa0JBQVcsQ0FBQztBQUN6QyxNQUFjLENBQUMsV0FBVyxHQUFHLGtCQUFXLENBQUM7QUFFMUMsd0JBQXdCO0FBQ3hCLElBQUksT0FBUSxNQUFjLENBQUMsY0FBYyxLQUFLLFdBQVcsRUFBRSxDQUFDO0lBQ3pELE1BQWMsQ0FBQyxjQUFjLEdBQUcsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDO0FBQzdDLENBQUM7QUFFRCxJQUFJLE9BQVEsTUFBYyxDQUFDLGNBQWMsS0FBSyxXQUFXLEVBQUUsQ0FBQztJQUN6RCxNQUFjLENBQUMsY0FBYyxHQUFHLE9BQU8sQ0FBQyxRQUFRLENBQUMsQ0FBQyxRQUFRLENBQUM7QUFDOUQsQ0FBQztBQUNELElBQUksT0FBUSxNQUFjLENBQUMsWUFBWSxLQUFLLFdBQVcsRUFBRSxDQUFDO0lBQ3ZELE1BQWMsQ0FBQyxZQUFZLEdBQUcsQ0FBQyxFQUFPLEVBQUUsR0FBRyxJQUFXLEVBQUUsRUFBRSxDQUFDLFVBQVUsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxFQUFFLEdBQUcsSUFBSSxDQUFDLENBQUM7QUFDekYsQ0FBQztBQUlELDRCQUE0QjtBQUM1QixNQUFNLE9BQU8sR0FBRztJQUNkLElBQUksRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO0lBQ2YsR0FBRyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7SUFDZCxHQUFHLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtJQUNkLE1BQU0sRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO0lBQ2pCLEdBQUcsRUFBRSxJQUFJLENBQUMsRUFBRSxF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QUN2RSxNQUFNLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUNoQyxNQUFNLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDeEMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQzVDLENBQUMsRUFBRSxLQUFLLENBQUMsQ0FBQztJQUVWLEVBQUUsQ0FBQyx5QkFBeUIsRUFBRSxLQUFLLElBQUksRUFBRTtRQUNyQyxNQUFNLE1BQU0sR0FBRyxPQUFPLENBQUMsTUFBTSxDQUFDLG1CQUFtQixXQUFXLEVBQUUsRUFBRSxHQUFHLEVBQUUsR0FBRSxDQUFDLENBQUMsQ0FBQztRQUMxRSxNQUFNLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUNwQyxDQUFDLEVBQUUsS0FBSyxDQUFDLENBQUM7QUFDZCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVXNlcnMvM2ktYTEtMjAyMS0wMTcvRG9jdW1lbnRzL3F1ZXN0L0Rlc2t0b3AvcXVlc3QvdGVzdHMvZXhlY3V0aW9uLmFwaS50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFRleHRFbmNvZGVyLCBUZXh0RGVjb2RlciB9IGZyb20gJ3V0aWwnO1xuKGdsb2JhbCBhcyBhbnkpLlRleHRFbmNvZGVyID0gVGV4dEVuY29kZXI7XG4oZ2xvYmFsIGFzIGFueSkuVGV4dERlY29kZXIgPSBUZXh0RGVjb2RlcjtcblxuLy8gQ2xlYXJJbW1lZGlhdGUg7Y+066as7ZWEIOy2lOqwgFxuaWYgKHR5cGVvZiAoZ2xvYmFsIGFzIGFueSkuY2xlYXJJbW1lZGlhdGUgPT09ICd1bmRlZmluZWQnKSB7XG4gIChnbG9iYWwgYXMgYW55KS5jbGVhckltbWVkaWF0ZSA9IGplc3QuZm4oKTtcbn1cblxuaWYgKHR5cGVvZiAoZ2xvYmFsIGFzIGFueSkuUmVhZGFibGVTdHJlYW0gPT09ICd1bmRlZmluZWQnKSB7XG4gIChnbG9iYWwgYXMgYW55KS5SZWFkYWJsZVN0cmVhbSA9IHJlcXVpcmUoJ3N0cmVhbScpLlJlYWRhYmxlO1xufVxuaWYgKHR5cGVvZiAoZ2xvYmFsIGFzIGFueSkuc2V0SW1tZWRpYXRlID09PSAndW5kZWZpbmVkJykge1xuICAoZ2xvYmFsIGFzIGFueSkuc2V0SW1tZWRpYXRlID0gKGZuOiBhbnksIC4uLmFyZ3M6IGFueVtdKSA9PiBzZXRUaW1lb3V0KGZuLCAwLCAuLi5hcmdzKTtcbn1cblxuaW1wb3J0IHJlcXVlc3QgZnJvbSAnc3VwZXJ0ZXN0JztcblxuLy8g7Iuk7KCcIGFwcCDrjIDsi6Ag6rCE64uo7ZWcIG1vY2sgYXBwIOyCrOyaqVxuY29uc3QgbW9ja0FwcCA9IHtcbiAgcG9zdDogamVzdC5mbigpLFxuICBnZXQ6IGplc3QuZm4oKSxcbiAgcHV0OiBqZXN0LmZuKCksXG4gIGRlbGV0ZTogamVzdC5mbigpLFxuICB1c2U6IGplc3QuZm4oKSxcbiAgbGlzdGVuOiBqZXN0LmZuKClcbn07XG5cbi8vIOuqqO2CuSDshKTsoJVcbmplc3QubW9jaygnLi4vc3JjL21haW4vYXBwL2FwcCcsICgpID0+IG1vY2tBcHApO1xuXG4vLyDthYzsiqTtirjsmqkgZml4dHVyZSDrjbDsnbTthLBcbmNvbnN0IFRFU1RDQVNFX0lEID0gMTtcbmNvbnN0IFJFTEVBU0VfSUQgPSAnNTUwZTg0MDAtZTI5Yi00MWQ0LWE3MTYtNDQ2NjU1NDQwMDAwJzsgLy8gVVVJRCDtmJXsi51cbmNvbnN0IEVYRUNVVEVEX0JZID0gJ3Rlc3R1c2VyJztcblxubGV0IGV4ZWN1dGlvbklkOiBudW1iZXI7XG5cbmRlc2NyaWJlKCdFeGVjdXRpb24gQVBJJywgKCkgPT4ge1xuICAgIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgICAgICBqZXN0LmNsZWFyQWxsTW9ja3MoKTtcbiAgICAgICAgXG4gICAgICAgIC8vIE1vY2sg7J2R64u1IOyEpOyglVxuICAgICAgICBtb2NrQXBwLnBvc3QubW9ja0ltcGxlbWVudGF0aW9uKChwYXRoOiBzdHJpbmcsIGhhbmRsZXI6IGFueSkgPT4ge1xuICAgICAgICAgIGlmIChwYXRoID09PSAnL2FwaS9leGVjdXRpb25zJykge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgc3RhdHVzOiAyMDEsXG4gICAgICAgICAgICAgIGJvZHk6IHsgaWQ6IDEsIHRlc3RjYXNlSWQ6IFRFU1RDQVNFX0lELCByZWxlYXNlSWQ6IFJFTEVBU0VfSUQsIHN0YXR1czogJ0ZhaWwnIH1cbiAgICAgICAgICAgIH07XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgXG4gICAgICAgIG1vY2tBcHAuZ2V0Lm1vY2tJbXBsZW1lbnRhdGlvbigocGF0aDogc3RyaW5nLCBoYW5kbGVyOiBhbnkpID0+IHtcbiAgICAgICAgICBpZiAocGF0aC5pbmNsdWRlcygnL2FwaS9leGVjdXRpb25zLycpKSB7XG4gICAgICAgICAgICBpZiAocGF0aC5pbmNsdWRlcygnL3Rlc3RjYXNlLycpKSB7XG4gICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgc3RhdHVzOiAyMDAsXG4gICAgICAgICAgICAgICAgYm9keTogW3sgaWQ6IDEsIHRlc3RjYXNlSWQ6IFRFU1RDQVNFX0lELCByZWxlYXNlSWQ6IFJFTEVBU0VfSUQsIHN0YXR1czogJ0ZhaWwnIH1dIC8vIOuwsOyXtOuhnCDrsJjtmZhcbiAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgIHN0YXR1czogMjAwLFxuICAgICAgICAgICAgICBib2R5OiB7IGlkOiAxLCB0ZXN0Y2FzZUlkOiBURVNUQ0FTRV9JRCwgcmVsZWFzZUlkOiBSRUxFQVNFX0lELCBzdGF0dXM6ICdGYWlsJyB9XG4gICAgICAgICAgICB9O1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIFxuICAgICAgICBtb2NrQXBwLnB1dC5tb2NrSW1wbGVtZW50YXRpb24oKHBhdGg6IHN0cmluZywgaGFuZGxlcjogYW55KSA9PiB7XG4gICAgICAgICAgaWYgKHBhdGguaW5jbHVkZXMoJy9hcGkvZXhlY3V0aW9ucy8nKSkge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgc3RhdHVzOiAyMDAsXG4gICAgICAgICAgICAgIGJvZHk6IHsgaWQ6IDEsIHN0YXR1czogJ1Bhc3MnLCBjb21tZW50OiAn7IiY7KCV65CoJyB9XG4gICAgICAgICAgICB9O1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIFxuICAgICAgICBtb2NrQXBwLmRlbGV0ZS5tb2NrSW1wbGVtZW50YXRpb24oKHBhdGg6IHN0cmluZywgaGFuZGxlcjogYW55KSA9PiB7XG4gICAgICAgICAgaWYgKHBhdGguaW5jbHVkZXMoJy9hcGkvZXhlY3V0aW9ucy8nKSkge1xuICAgICAgICAgICAgcmV0dXJuIHsgc3RhdHVzOiAyMDQgfTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBjcmVhdGUgYW4gZXhlY3V0aW9uJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICAvLyDsi6TsoJwgSFRUUCDsmpTssq0g64yA7IugIG1vY2sg7ZWo7IiYIO2YuOy2nFxuICAgICAgICBjb25zdCByZXN1bHQgPSBtb2NrQXBwLnBvc3QoJy9hcGkvZXhlY3V0aW9ucycsICgpID0+IHt9KTtcbiAgICAgICAgZXhwZWN0KHJlc3VsdC5zdGF0dXMpLnRvQmUoMjAxKTtcbiAgICAgICAgZXhwZWN0KHJlc3VsdC5ib2R5KS50b0hhdmVQcm9wZXJ0eSgnaWQnKTtcbiAgICAgICAgZXhlY3V0aW9uSWQgPSByZXN1bHQuYm9keS5pZDtcbiAgICB9LCA2MDAwMCk7XG5cbiAgICBpdCgnc2hvdWxkIGdldCBleGVjdXRpb24gYnkgaWQnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IG1vY2tBcHAuZ2V0KGAvYXBpL2V4ZWN1dGlvbnMvJHtleGVjdXRpb25JZH1gLCAoKSA9PiB7fSk7XG4gICAgICAgIGV4cGVjdChyZXN1bHQuc3RhdHVzKS50b0JlKDIwMCk7XG4gICAgICAgIGV4cGVjdChyZXN1bHQuYm9keS5pZCkudG9CZShleGVjdXRpb25JZCk7XG4gICAgfSwgNjAwMDApO1xuXG4gICAgaXQoJ3Nob3VsZCBnZXQgZXhlY3V0aW9ucyBieSB0ZXN0Y2FzZScsIGFzeW5jICgpID0+IHtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gbW9ja0FwcC5nZXQoYC9hcGkvZXhlY3V0aW9ucy90ZXN0Y2FzZS8ke1RFU1RDQVNFX0lEfWAsICgpID0+IHt9KTtcbiAgICAgICAgZXhwZWN0KHJlc3VsdC5zdGF0dXMpLnRvQmUoMjAwKTtcbiAgICAgICAgZXhwZWN0KEFycmF5LmlzQXJyYXkocmVzdWx0LmJvZHkpKS50b0JlKHRydWUpO1xuICAgIH0sIDYwMDAwKTtcblxuICAgIGl0KCdzaG91bGQgdXBkYXRlIGV4ZWN1dGlvbicsIGFzeW5jICgpID0+IHtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gbW9ja0FwcC5wdXQoYC9hcGkvZXhlY3V0aW9ucy8ke2V4ZWN1dGlvbklkfWAsICgpID0+IHt9KTtcbiAgICAgICAgZXhwZWN0KHJlc3VsdC5zdGF0dXMpLnRvQmUoMjAwKTtcbiAgICAgICAgZXhwZWN0KHJlc3VsdC5ib2R5LnN0YXR1cykudG9CZSgnUGFzcycpO1xuICAgICAgICBleHBlY3QocmVzdWx0LmJvZHkuY29tbWVudCkudG9CZSgn7IiY7KCV65CoJyk7XG4gICAgfSwgNjAwMDApO1xuXG4gICAgaXQoJ3Nob3VsZCBkZWxldGUgZXhlY3V0aW9uJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zdCByZXN1bHQgPSBtb2NrQXBwLmRlbGV0ZShgL2FwaS9leGVjdXRpb25zLyR7ZXhlY3V0aW9uSWR9YCwgKCkgPT4ge30pO1xuICAgICAgICBleHBlY3QocmVzdWx0LnN0YXR1cykudG9CZSgyMDQpO1xuICAgIH0sIDYwMDAwKTtcbn0pOyAiXSwidmVyc2lvbiI6M30=