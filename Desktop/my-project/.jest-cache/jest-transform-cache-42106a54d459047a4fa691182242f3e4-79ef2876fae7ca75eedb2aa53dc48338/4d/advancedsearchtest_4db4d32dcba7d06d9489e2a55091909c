25a7fd03a62d3252a63fa8a1494dfd36
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
// Mock Elasticsearch client
jest.mock('../src/main/app/infrastructure/elasticsearch/esClient', () => ({
    search: jest.fn(),
    index: jest.fn(),
    delete: jest.fn(),
}));
const advancedSearchService_1 = require("../src/main/app/domains/testcases/elasticsearch/advancedSearchService");
describe('Advanced Search Service', () => {
    beforeEach(() => {
        jest.clearAllMocks();
    });
    describe('buildAdvancedQuery', () => {
        it('should build basic query without filters', () => {
            const filters = {};
            const query = (0, advancedSearchService_1.buildAdvancedQuery)(filters);
            expect(query.query.bool.must).toEqual([]);
            expect(query.query.bool.should).toEqual([]);
            expect(query.query.bool.filter).toEqual([]);
            expect(query.query.bool.minimum_should_match).toBe(0);
        });
        it('should build query with keyword search', () => {
            const filters = {
                keyword: 'login test'
            };
            const query = (0, advancedSearchService_1.buildAdvancedQuery)(filters);
            expect(query.query.bool.should).toHaveLength(4);
            expect(query.query.bool.should[0]).toEqual({
                match: { title: { query: 'login test', boost: 3 } }
            });
            expect(query.query.bool.minimum_should_match).toBe(1);
        });
        it('should build query with multiple filters', () => {
            const filters = {
                keyword: 'test',
                folders: ['Smoke Tests'],
                tags: ['critical'],
                status: ['Active'],
                priority: ['High'],
                createdBy: ['tester1'],
                dateRange: {
                    from: '2024-01-01',
                    to: '2024-12-31'
                }
            };
            const query = (0, advancedSearchService_1.buildAdvancedQuery)(filters);
            // 키워드 검색
            expect(query.query.bool.should).toHaveLength(4);
            expect(query.query.bool.minimum_should_match).toBe(1);
            // 필터 조건들
            expect(query.query.bool.filter).toHaveLength(5);
            expect(query.query.bool.filter).toContainEqual({
                terms: { folder: ['Smoke Tests'] }
            });
            expect(query.query.bool.filter).toContainEqual({
                terms: { tags: ['critical'] }
            });
            expect(query.query.bool.filter).toContainEqual({
                terms: { status: ['Active'] }
            });
            expect(query.query.bool.filter).toContainEqual({
                terms: { priority: ['High'] }
            });
            expect(query.query.bool.filter).toContainEqual({
                terms: { createdBy: ['tester1'] }
            });
            expect(query.query.bool.filter).toContainEqual({
                range: { createdAt: { gte: '2024-01-01', lte: '2024-12-31' } }
            });
        });
        it('should build query with date range filters', () => {
            const filters = {
                dateRange: {
                    from: '2024-01-01',
                    to: '2024-12-31'
                }
            };
            const query = (0, advancedSearchService_1.buildAdvancedQuery)(filters);
            expect(query.query.bool.filter).toContainEqual({
                range: { createdAt: { gte: '2024-01-01', lte: '2024-12-31' } }
            });
        });
        it('should build query with only from date', () => {
            const filters = {
                dateRange: {
                    from: '2024-01-01',
                    to: ''
                }
            };
            const query = (0, advancedSearchService_1.buildAdvancedQuery)(filters);
            expect(query.query.bool.filter).toContainEqual({
                range: { createdAt: { gte: '2024-01-01' } }
            });
        });
        it('should build query with only to date', () => {
            const filters = {
                dateRange: {
                    from: '',
                    to: '2024-12-31'
                }
            };
            const query = (0, advancedSearchService_1.buildAdvancedQuery)(filters);
            expect(query.query.bool.filter).toContainEqual({
                range: { createdAt: { lte: '2024-12-31' } }
            });
        });
    });
    describe('advancedSearch', () => {
        it('should execute advanced search and return results', async () => {
            const mockSearchResult = {
                hits: {
                    hits: [
                        {
                            _id: '1',
                            _source: {
                                id: 1,
                                title: 'Login Test',
                                priority: 'High',
                                status: 'Active',
                                createdBy: 'tester1',
                                createdAt: '2024-01-15T00:00:00Z'
                            },
                            highlight: {
                                title: ['<mark>Login</mark> Test']
                            }
                        }
                    ],
                    total: { value: 1 }
                }
            };
            const esClient = require('../src/main/app/infrastructure/elasticsearch/esClient');
            esClient.search.mockResolvedValue(mockSearchResult);
            const filters = {
                keyword: 'login',
                status: ['Active']
            };
            const result = await (0, advancedSearchService_1.advancedSearch)(filters, 0, 20);
            expect(result.testCases).toHaveLength(1);
            expect(result.testCases[0].title).toBe('Login Test');
            expect(result.total).toBe(1);
            expect(result.highlights['1']).toEqual(['<mark>Login</mark> Test']);
        });
        it('should handle search errors gracefully', async () => {
            const esClient = require('../src/main/app/infrastructure/elasticsearch/esClient');
            esClient.search.mockRejectedValue(new Error('Search failed'));
            const filters = {
                keyword: 'test'
            };
            await expect((0, advancedSearchService_1.advancedSearch)(filters)).rejects.toThrow('Search failed');
        });
    });
    describe('Search Presets', () => {
        it('should save search preset', async () => {
            const mockPreset = {
                id: 'preset_123',
                name: 'Critical Tests',
                filters: {
                    priority: ['High'],
                    tags: ['critical']
                },
                createdBy: 'tester1',
                createdAt: '2024-01-15T00:00:00Z'
            };
            const esClient = require('../src/main/app/infrastructure/elasticsearch/esClient');
            esClient.index.mockResolvedValue({});
            const presetData = {
                name: 'Critical Tests',
                filters: {
                    priority: ['High'],
                    tags: ['critical']
                },
                createdBy: 'tester1'
            };
            const result = await (0, advancedSearchService_1.saveSearchPreset)(presetData);
            expect(result.name).toBe('Critical Tests');
            expect(result.filters).toEqual(presetData.filters);
            expect(result.createdBy).toBe('tester1');
            expect(result.id).toMatch(/^preset_\d+_/);
            expect(result.createdAt).toBeDefined();
        });
        it('should get search presets', async () => {
            const mockPresets = [
                {
                    _id: 'preset_1',
                    _source: {
                        id: 'preset_1',
                        name: 'Critical Tests',
                        filters: { priority: ['High'] },
                        createdBy: 'tester1',
                        createdAt: '2024-01-15T00:00:00Z'
                    }
                }
            ];
            const esClient = require('../src/main/app/infrastructure/elasticsearch/esClient');
            esClient.search.mockResolvedValue({
                hits: { hits: mockPresets }
            });
            const presets = await (0, advancedSearchService_1.getSearchPresets)('tester1');
            expect(presets).toHaveLength(1);
            expect(presets[0].name).toBe('Critical Tests');
            expect(presets[0].createdBy).toBe('tester1');
        });
        it('should delete search preset', async () => {
            const esClient = require('../src/main/app/infrastructure/elasticsearch/esClient');
            esClient.delete.mockResolvedValue({});
            const result = await (0, advancedSearchService_1.deleteSearchPreset)('preset_123');
            expect(result).toBe(true);
            expect(esClient.delete).toHaveBeenCalledWith({
                index: 'search_presets',
                id: 'preset_123'
            });
        });
        it('should handle delete preset errors', async () => {
            const esClient = require('../src/main/app/infrastructure/elasticsearch/esClient');
            esClient.delete.mockRejectedValue(new Error('Delete failed'));
            const result = await (0, advancedSearchService_1.deleteSearchPreset)('preset_123');
            expect(result).toBe(false);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzLzNpLWExLTIwMjEtMDE3L0Rlc2t0b3AvbXktcHJvamVjdC90ZXN0cy9hZHZhbmNlZC1zZWFyY2gudGVzdC50cyIsIm1hcHBpbmdzIjoiOztBQUdBLDRCQUE0QjtBQUM1QixJQUFJLENBQUMsSUFBSSxDQUFDLHVEQUF1RCxFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUM7SUFDeEUsTUFBTSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7SUFDakIsS0FBSyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7SUFDaEIsTUFBTSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7Q0FDbEIsQ0FBQyxDQUFDLENBQUM7QUFSSixpSEFBbUw7QUFVbkwsUUFBUSxDQUFDLHlCQUF5QixFQUFFLEdBQUcsRUFBRTtJQUN2QyxVQUFVLENBQUMsR0FBRyxFQUFFO1FBQ2QsSUFBSSxDQUFDLGFBQWEsRUFBRSxDQUFDO0lBQ3ZCLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLG9CQUFvQixFQUFFLEdBQUcsRUFBRTtRQUNsQyxFQUFFLENBQUMsMENBQTBDLEVBQUUsR0FBRyxFQUFFO1lBQ2xELE1BQU0sT0FBTyxHQUF5QixFQUFFLENBQUM7WUFDekMsTUFBTSxLQUFLLEdBQUcsSUFBQSwwQ0FBa0IsRUFBQyxPQUFPLENBQUMsQ0FBQztZQUUxQyxNQUFNLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsT0FBTyxDQUFDLEVBQUUsQ0FBQyxDQUFDO1lBQzFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQyxPQUFPLENBQUMsRUFBRSxDQUFDLENBQUM7WUFDNUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUMsQ0FBQztZQUM1QyxNQUFNLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsb0JBQW9CLENBQUMsQ0FB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QixFQUFFLEtBQUssSUFBSSxFQUFFO1lBQzNDLE1BQU0sUUFBUSxHQUFHLE9BQU8sQ0FBQyx1REFBdUQsQ0FBQyxDQUFDO1lBQ2xGLFFBQVEsQ0FBQyxNQUFNLENBQUMsaUJBQWlCLENBQUMsRUFBRSxDQUFDLENBQUM7WUFFdEMsTUFBTSxNQUFNLEdBQUcsTUFBTSxJQUFBLDBDQUFrQixFQUFDLFlBQVksQ0FBQyxDQUFDO1lBRXRELE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDMUIsTUFBTSxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsQ0FBQyxvQkFBb0IsQ0FBQztnQkFDM0MsS0FBSyxFQUFFLGdCQUFnQjtnQkFDdkIsRUFBRSxFQUFFLFlBQVk7YUFDakIsQ0FBQyxDQUFDO1FBQ0wsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsb0NBQW9DLEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDbEQsTUFBTSxRQUFRLEdBQUcsT0FBTyxDQUFDLHVEQUF1RCxDQUFDLENBQUM7WUFDbEYsUUFBUSxDQUFDLE1BQU0sQ0FBQyxpQkFBaUIsQ0FBQyxJQUFJLEtBQUssQ0FBQyxlQUFlLENBQUMsQ0FBQyxDQUFDO1lBRTlELE1BQU0sTUFBTSxHQUFHLE1BQU0sSUFBQSwwQ0FBa0IsRUFBQyxZQUFZLENBQUMsQ0FBQztZQUV0RCxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQzdCLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVXNlcnMvM2ktYTEtMjAyMS0wMTcvRGVza3RvcC9teS1wcm9qZWN0L3Rlc3RzL2FkdmFuY2VkLXNlYXJjaC50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGJ1aWxkQWR2YW5jZWRRdWVyeSwgYWR2YW5jZWRTZWFyY2gsIHNhdmVTZWFyY2hQcmVzZXQsIGdldFNlYXJjaFByZXNldHMsIGRlbGV0ZVNlYXJjaFByZXNldCB9IGZyb20gJy4uL3NyYy9tYWluL2FwcC9kb21haW5zL3Rlc3RjYXNlcy9lbGFzdGljc2VhcmNoL2FkdmFuY2VkU2VhcmNoU2VydmljZSc7XG5pbXBvcnQgeyBBZHZhbmNlZFNlYXJjaEZpbHRlciB9IGZyb20gJy4uL3NyYy9tYWluL2FwcC9kb21haW5zL3Rlc3RjYXNlcy9lbGFzdGljc2VhcmNoL2FkdmFuY2VkU2VhcmNoU2VydmljZSc7XG5cbi8vIE1vY2sgRWxhc3RpY3NlYXJjaCBjbGllbnRcbmplc3QubW9jaygnLi4vc3JjL21haW4vYXBwL2luZnJhc3RydWN0dXJlL2VsYXN0aWNzZWFyY2gvZXNDbGllbnQnLCAoKSA9PiAoe1xuICBzZWFyY2g6IGplc3QuZm4oKSxcbiAgaW5kZXg6IGplc3QuZm4oKSxcbiAgZGVsZXRlOiBqZXN0LmZuKCksXG59KSk7XG5cbmRlc2NyaWJlKCdBZHZhbmNlZCBTZWFyY2ggU2VydmljZScsICgpID0+IHtcbiAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgamVzdC5jbGVhckFsbE1vY2tzKCk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdidWlsZEFkdmFuY2VkUXVlcnknLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBidWlsZCBiYXNpYyBxdWVyeSB3aXRob3V0IGZpbHRlcnMnLCAoKSA9PiB7XG4gICAgICBjb25zdCBmaWx0ZXJzOiBBZHZhbmNlZFNlYXJjaEZpbHRlciA9IHt9O1xuICAgICAgY29uc3QgcXVlcnkgPSBidWlsZEFkdmFuY2VkUXVlcnkoZmlsdGVycyk7XG5cbiAgICAgIGV4cGVjdChxdWVyeS5xdWVyeS5ib29sLm11c3QpLnRvRXF1YWwoW10pO1xuICAgICAgZXhwZWN0KHF1ZXJ5LnF1ZXJ5LmJvb2wuc2hvdWxkKS50b0VxdWFsKFtdKTtcbiAgICAgIGV4cGVjdChxdWVyeS5xdWVyeS5ib29sLmZpbHRlcikudG9FcXVhbChbXSk7XG4gICAgICBleHBlY3QocXVlcnkucXVlcnkuYm9vbC5taW5pbXVtX3Nob3VsZF9tYXRjaCkudG9CZSgwKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgYnVpbGQgcXVlcnkgd2l0aCBrZXl3b3JkIHNlYXJjaCcsICgpID0+IHtcbiAgICAgIGNvbnN0IGZpbHRlcnM6IEFkdmFuY2VkU2VhcmNoRmlsdGVyID0ge1xuICAgICAgICBrZXl3b3JkOiAnbG9naW4gdGVzdCdcbiAgICAgIH07XG4gICAgICBjb25zdCBxdWVyeSA9IGJ1aWxkQWR2YW5jZWRRdWVyeShmaWx0ZXJzKTtcblxuICAgICAgZXhwZWN0KHF1ZXJ5LnF1ZXJ5LmJvb2wuc2hvdWxkKS50b0hhdmVMZW5ndGgoNCk7XG4gICAgICBleHBlY3QocXVlcnkucXVlcnkuYm9vbC5zaG91bGRbMF0pLnRvRXF1YWwoe1xuICAgICAgICBtYXRjaDogeyB0aXRsZTogeyBxdWVyeTogJ2xvZ2luIHRlc3QnLCBib29zdDogMyB9IH1cbiAgICAgIH0pO1xuICAgICAgZXhwZWN0KHF1ZXJ5LnF1ZXJ5LmJvb2wubWluaW11bV9zaG91bGRfbWF0Y2gpLnRvQmUoMSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGJ1aWxkIHF1ZXJ5IHdpdGggbXVsdGlwbGUgZmlsdGVycycsICgpID0+IHtcbiAgICAgIGNvbnN0IGZpbHRlcnM6IEFkdmFuY2VkU2VhcmNoRmlsdGVyID0ge1xuICAgICAgICBrZXl3b3JkOiAndGVzdCcsXG4gICAgICAgIGZvbGRlcnM6IFsnU21va2UgVGVzdHMnXSxcbiAgICAgICAgdGFnczogWydjcml0aWNhbCddLFxuICAgICAgICBzdGF0dXM6IFsnQWN0aXZlJ10sXG4gICAgICAgIHByaW9yaXR5OiBbJ0hpZ2gnXSxcbiAgICAgICAgY3JlYXRlZEJ5OiBbJ3Rlc3RlcjEnXSxcbiAgICAgICAgZGF0ZVJhbmdlOiB7XG4gICAgICAgICAgZnJvbTogJzIwMjQtMDEtMDEnLFxuICAgICAgICAgIHRvOiAnMjAyNC0xMi0zMSdcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICAgIGNvbnN0IHF1ZXJ5ID0gYnVpbGRBZHZhbmNlZFF1ZXJ5KGZpbHRlcnMpO1xuXG4gICAgICAvLyDtgqTsm4zrk5wg6rKA7IOJXG4gICAgICBleHBlY3QocXVlcnkucXVlcnkuYm9vbC5zaG91bGQpLnRvSGF2ZUxlbmd0aCg0KTtcbiAgICAgIGV4cGVjdChxdWVyeS5xdWVyeS5ib29sLm1pbmltdW1fc2hvdWxkX21hdGNoKS50b0JlKDEpO1xuXG4gICAgICAvLyDtlYTthLAg7KGw6rG065OkXG4gICAgICBleHBlY3QocXVlcnkucXVlcnkuYm9vbC5maWx0ZXIpLnRvSGF2ZUxlbmd0aCg1KTtcbiAgICAgIGV4cGVjdChxdWVyeS5xdWVyeS5ib29sLmZpbHRlcikudG9Db250YWluRXF1YWwoe1xuICAgICAgICB0ZXJtczogeyBmb2xkZXI6IFsnU21va2UgVGVzdHMnXSB9XG4gICAgICB9KTtcbiAgICAgIGV4cGVjdChxdWVyeS5xdWVyeS5ib29sLmZpbHRlcikudG9Db250YWluRXF1YWwoe1xuICAgICAgICB0ZXJtczogeyB0YWdzOiBbJ2NyaXRpY2FsJ10gfVxuICAgICAgfSk7XG4gICAgICBleHBlY3QocXVlcnkucXVlcnkuYm9vbC5maWx0ZXIpLnRvQ29udGFpbkVxdWFsKHtcbiAgICAgICAgdGVybXM6IHsgc3RhdHVzOiBbJ0FjdGl2ZSddIH1cbiAgICAgIH0pO1xuICAgICAgZXhwZWN0KHF1ZXJ5LnF1ZXJ5LmJvb2wuZmlsdGVyKS50b0NvbnRhaW5FcXVhbCh7XG4gICAgICAgIHRlcm1zOiB7IHByaW9yaXR5OiBbJ0hpZ2gnXSB9XG4gICAgICB9KTtcbiAgICAgIGV4cGVjdChxdWVyeS5xdWVyeS5ib29sLmZpbHRlcikudG9Db250YWluRXF1YWwoe1xuICAgICAgICB0ZXJtczogeyBjcmVhdGVkQnk6IFsndGVzdGVyMSddIH1cbiAgICAgIH0pO1xuICAgICAgZXhwZWN0KHF1ZXJ5LnF1ZXJ5LmJvb2wuZmlsdGVyKS50b0NvbnRhaW5FcXVhbCh7XG4gICAgICAgIHJhbmdlOiB7IGNyZWF0ZWRBdDogeyBndGU6ICcyMDI0LTAxLTAxJywgbHRlOiAnMjAyNC0xMi0zMScgfSB9XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgYnVpbGQgcXVlcnkgd2l0aCBkYXRlIHJhbmdlIGZpbHRlcnMnLCAoKSA9PiB7XG4gICAgICBjb25zdCBmaWx0ZXJzOiBBZHZhbmNlZFNlYXJjaEZpbHRlciA9IHtcbiAgICAgICAgZGF0ZVJhbmdlOiB7XG4gICAgICAgICAgZnJvbTogJzIwMjQtMDEtMDEnLFxuICAgICAgICAgIHRvOiAnMjAyNC0xMi0zMSdcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICAgIGNvbnN0IHF1ZXJ5ID0gYnVpbGRBZHZhbmNlZFF1ZXJ5KGZpbHRlcnMpO1xuXG4gICAgICBleHBlY3QocXVlcnkucXVlcnkuYm9vbC5maWx0ZXIpLnRvQ29udGFpbkVxdWFsKHtcbiAgICAgICAgcmFuZ2U6IHsgY3JlYXRlZEF0OiB7IGd0ZTogJzIwMjQtMDEtMDEnLCBsdGU6ICcyMDI0LTEyLTMxJyB9IH1cbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBidWlsZCBxdWVyeSB3aXRoIG9ubHkgZnJvbSBkYXRlJywgKCkgPT4ge1xuICAgICAgY29uc3QgZmlsdGVyczogQWR2YW5jZWRTZWFyY2hGaWx0ZXIgPSB7XG4gICAgICAgIGRhdGVSYW5nZToge1xuICAgICAgICAgIGZyb206ICcyMDI0LTAxLTAxJyxcbiAgICAgICAgICB0bzogJydcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICAgIGNvbnN0IHF1ZXJ5ID0gYnVpbGRBZHZhbmNlZFF1ZXJ5KGZpbHRlcnMpO1xuXG4gICAgICBleHBlY3QocXVlcnkucXVlcnkuYm9vbC5maWx0ZXIpLnRvQ29udGFpbkVxdWFsKHtcbiAgICAgICAgcmFuZ2U6IHsgY3JlYXRlZEF0OiB7IGd0ZTogJzIwMjQtMDEtMDEnIH0gfVxuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGJ1aWxkIHF1ZXJ5IHdpdGggb25seSB0byBkYXRlJywgKCkgPT4ge1xuICAgICAgY29uc3QgZmlsdGVyczogQWR2YW5jZWRTZWFyY2hGaWx0ZXIgPSB7XG4gICAgICAgIGRhdGVSYW5nZToge1xuICAgICAgICAgIGZyb206ICcnLFxuICAgICAgICAgIHRvOiAnMjAyNC0xMi0zMSdcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICAgIGNvbnN0IHF1ZXJ5ID0gYnVpbGRBZHZhbmNlZFF1ZXJ5KGZpbHRlcnMpO1xuXG4gICAgICBleHBlY3QocXVlcnkucXVlcnkuYm9vbC5maWx0ZXIpLnRvQ29udGFpbkVxdWFsKHtcbiAgICAgICAgcmFuZ2U6IHsgY3JlYXRlZEF0OiB7IGx0ZTogJzIwMjQtMTItMzEnIH0gfVxuICAgICAgfSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdhZHZhbmNlZFNlYXJjaCcsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGV4ZWN1dGUgYWR2YW5jZWQgc2VhcmNoIGFuZCByZXR1cm4gcmVzdWx0cycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tTZWFyY2hSZXN1bHQgPSB7XG4gICAgICAgIGhpdHM6IHtcbiAgICAgICAgICBoaXRzOiBbXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIF9pZDogJzEnLFxuICAgICAgICAgICAgICBfc291cmNlOiB7XG4gICAgICAgICAgICAgICAgaWQ6IDEsXG4gICAgICAgICAgICAgICAgdGl0bGU6ICdMb2dpbiBUZXN0JyxcbiAgICAgICAgICAgICAgICBwcmlvcml0eTogJ0hpZ2gnLFxuICAgICAgICAgICAgICAgIHN0YXR1czogJ0FjdGl2ZScsXG4gICAgICAgICAgICAgICAgY3JlYXRlZEJ5OiAndGVzdGVyMScsXG4gICAgICAgICAgICAgICAgY3JlYXRlZEF0OiAnMjAyNC0wMS0xNVQwMDowMDowMFonXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIGhpZ2hsaWdodDoge1xuICAgICAgICAgICAgICAgIHRpdGxlOiBbJzxtYXJrPkxvZ2luPC9tYXJrPiBUZXN0J11cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIF0sXG4gICAgICAgICAgdG90YWw6IHsgdmFsdWU6IDEgfVxuICAgICAgICB9XG4gICAgICB9O1xuXG4gICAgICBjb25zdCBlc0NsaWVudCA9IHJlcXVpcmUoJy4uL3NyYy9tYWluL2FwcC9pbmZyYXN0cnVjdHVyZS9lbGFzdGljc2VhcmNoL2VzQ2xpZW50Jyk7XG4gICAgICBlc0NsaWVudC5zZWFyY2gubW9ja1Jlc29sdmVkVmFsdWUobW9ja1NlYXJjaFJlc3VsdCk7XG5cbiAgICAgIGNvbnN0IGZpbHRlcnM6IEFkdmFuY2VkU2VhcmNoRmlsdGVyID0ge1xuICAgICAgICBrZXl3b3JkOiAnbG9naW4nLFxuICAgICAgICBzdGF0dXM6IFsnQWN0aXZlJ11cbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGFkdmFuY2VkU2VhcmNoKGZpbHRlcnMsIDAsIDIwKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC50ZXN0Q2FzZXMpLnRvSGF2ZUxlbmd0aCgxKTtcbiAgICAgIGV4cGVjdChyZXN1bHQudGVzdENhc2VzWzBdLnRpdGxlKS50b0JlKCdMb2dpbiBUZXN0Jyk7XG4gICAgICBleHBlY3QocmVzdWx0LnRvdGFsKS50b0JlKDEpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5oaWdobGlnaHRzWycxJ10pLnRvRXF1YWwoWyc8bWFyaz5Mb2dpbjwvbWFyaz4gVGVzdCddKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIHNlYXJjaCBlcnJvcnMgZ3JhY2VmdWxseScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGVzQ2xpZW50ID0gcmVxdWlyZSgnLi4vc3JjL21haW4vYXBwL2luZnJhc3RydWN0dXJlL2VsYXN0aWNzZWFyY2gvZXNDbGllbnQnKTtcbiAgICAgIGVzQ2xpZW50LnNlYXJjaC5tb2NrUmVqZWN0ZWRWYWx1ZShuZXcgRXJyb3IoJ1NlYXJjaCBmYWlsZWQnKSk7XG5cbiAgICAgIGNvbnN0IGZpbHRlcnM6IEFkdmFuY2VkU2VhcmNoRmlsdGVyID0ge1xuICAgICAgICBrZXl3b3JkOiAndGVzdCdcbiAgICAgIH07XG5cbiAgICAgIGF3YWl0IGV4cGVjdChhZHZhbmNlZFNlYXJjaChmaWx0ZXJzKSkucmVqZWN0cy50b1Rocm93KCdTZWFyY2ggZmFpbGVkJyk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdTZWFyY2ggUHJlc2V0cycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHNhdmUgc2VhcmNoIHByZXNldCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tQcmVzZXQgPSB7XG4gICAgICAgIGlkOiAncHJlc2V0XzEyMycsXG4gICAgICAgIG5hbWU6ICdDcml0aWNhbCBUZXN0cycsXG4gICAgICAgIGZpbHRlcnM6IHtcbiAgICAgICAgICBwcmlvcml0eTogWydIaWdoJ10sXG4gICAgICAgICAgdGFnczogWydjcml0aWNhbCddXG4gICAgICAgIH0sXG4gICAgICAgIGNyZWF0ZWRCeTogJ3Rlc3RlcjEnLFxuICAgICAgICBjcmVhdGVkQXQ6ICcyMDI0LTAxLTE1VDAwOjAwOjAwWidcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IGVzQ2xpZW50ID0gcmVxdWlyZSgnLi4vc3JjL21haW4vYXBwL2luZnJhc3RydWN0dXJlL2VsYXN0aWNzZWFyY2gvZXNDbGllbnQnKTtcbiAgICAgIGVzQ2xpZW50LmluZGV4Lm1vY2tSZXNvbHZlZFZhbHVlKHt9KTtcblxuICAgICAgY29uc3QgcHJlc2V0RGF0YSA9IHtcbiAgICAgICAgbmFtZTogJ0NyaXRpY2FsIFRlc3RzJyxcbiAgICAgICAgZmlsdGVyczoge1xuICAgICAgICAgIHByaW9yaXR5OiBbJ0hpZ2gnIGFzIGNvbnN0XSxcbiAgICAgICAgICB0YWdzOiBbJ2NyaXRpY2FsJ11cbiAgICAgICAgfSxcbiAgICAgICAgY3JlYXRlZEJ5OiAndGVzdGVyMSdcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNhdmVTZWFyY2hQcmVzZXQocHJlc2V0RGF0YSk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQubmFtZSkudG9CZSgnQ3JpdGljYWwgVGVzdHMnKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuZmlsdGVycykudG9FcXVhbChwcmVzZXREYXRhLmZpbHRlcnMpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5jcmVhdGVkQnkpLnRvQmUoJ3Rlc3RlcjEnKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuaWQpLnRvTWF0Y2goL15wcmVzZXRfXFxkK18vKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuY3JlYXRlZEF0KS50b0JlRGVmaW5lZCgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBnZXQgc2VhcmNoIHByZXNldHMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrUHJlc2V0cyA9IFtcbiAgICAgICAge1xuICAgICAgICAgIF9pZDogJ3ByZXNldF8xJyxcbiAgICAgICAgICBfc291cmNlOiB7XG4gICAgICAgICAgICBpZDogJ3ByZXNldF8xJyxcbiAgICAgICAgICAgIG5hbWU6ICdDcml0aWNhbCBUZXN0cycsXG4gICAgICAgICAgICBmaWx0ZXJzOiB7IHByaW9yaXR5OiBbJ0hpZ2gnXSB9LFxuICAgICAgICAgICAgY3JlYXRlZEJ5OiAndGVzdGVyMScsXG4gICAgICAgICAgICBjcmVhdGVkQXQ6ICcyMDI0LTAxLTE1VDAwOjAwOjAwWidcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIF07XG5cbiAgICAgIGNvbnN0IGVzQ2xpZW50ID0gcmVxdWlyZSgnLi4vc3JjL21haW4vYXBwL2luZnJhc3RydWN0dXJlL2VsYXN0aWNzZWFyY2gvZXNDbGllbnQnKTtcbiAgICAgIGVzQ2xpZW50LnNlYXJjaC5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICAgIGhpdHM6IHsgaGl0czogbW9ja1ByZXNldHMgfVxuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IHByZXNldHMgPSBhd2FpdCBnZXRTZWFyY2hQcmVzZXRzKCd0ZXN0ZXIxJyk7XG5cbiAgICAgIGV4cGVjdChwcmVzZXRzKS50b0hhdmVMZW5ndGgoMSk7XG4gICAgICBleHBlY3QocHJlc2V0c1swXS5uYW1lKS50b0JlKCdDcml0aWNhbCBUZXN0cycpO1xuICAgICAgZXhwZWN0KHByZXNldHNbMF0uY3JlYXRlZEJ5KS50b0JlKCd0ZXN0ZXIxJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGRlbGV0ZSBzZWFyY2ggcHJlc2V0JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgZXNDbGllbnQgPSByZXF1aXJlKCcuLi9zcmMvbWFpbi9hcHAvaW5mcmFzdHJ1Y3R1cmUvZWxhc3RpY3NlYXJjaC9lc0NsaWVudCcpO1xuICAgICAgZXNDbGllbnQuZGVsZXRlLm1vY2tSZXNvbHZlZFZhbHVlKHt9KTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZGVsZXRlU2VhcmNoUHJlc2V0KCdwcmVzZXRfMTIzJyk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmUodHJ1ZSk7XG4gICAgICBleHBlY3QoZXNDbGllbnQuZGVsZXRlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XG4gICAgICAgIGluZGV4OiAnc2VhcmNoX3ByZXNldHMnLFxuICAgICAgICBpZDogJ3ByZXNldF8xMjMnXG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGRlbGV0ZSBwcmVzZXQgZXJyb3JzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgZXNDbGllbnQgPSByZXF1aXJlKCcuLi9zcmMvbWFpbi9hcHAvaW5mcmFzdHJ1Y3R1cmUvZWxhc3RpY3NlYXJjaC9lc0NsaWVudCcpO1xuICAgICAgZXNDbGllbnQuZGVsZXRlLm1vY2tSZWplY3RlZFZhbHVlKG5ldyBFcnJvcignRGVsZXRlIGZhaWxlZCcpKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZGVsZXRlU2VhcmNoUHJlc2V0KCdwcmVzZXRfMTIzJyk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmUoZmFsc2UpO1xuICAgIH0pO1xuICB9KTtcbn0pOyAiXSwidmVyc2lvbiI6M30=